

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>matplotlib.backend_bases &mdash; mpl_qt_viz 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> mpl_qt_viz
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../mpl_qt_viz.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">mpl_qt_viz</span></code></a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">mpl_qt_viz</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>matplotlib.backend_bases</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for matplotlib.backend_bases</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Abstract base classes define the primitives that renderers and</span>
<span class="sd">graphics contexts must implement to serve as a Matplotlib backend.</span>

<span class="sd">`RendererBase`</span>
<span class="sd">    An abstract base class to handle drawing/rendering operations.</span>

<span class="sd">`FigureCanvasBase`</span>
<span class="sd">    The abstraction layer that separates the `.Figure` from the backend</span>
<span class="sd">    specific details like a user interface drawing area.</span>

<span class="sd">`GraphicsContextBase`</span>
<span class="sd">    An abstract base class that provides color, line styles, etc.</span>

<span class="sd">`Event`</span>
<span class="sd">    The base class for all of the Matplotlib event handling.  Derived classes</span>
<span class="sd">    such as `KeyEvent` and `MouseEvent` store the meta data like keys and</span>
<span class="sd">    buttons pressed, x and y locations in pixel and `~.axes.Axes` coordinates.</span>

<span class="sd">`ShowBase`</span>
<span class="sd">    The base class for the ``Show`` class of each interactive backend; the</span>
<span class="sd">    &#39;show&#39; callable is then set to ``Show.__call__``.</span>

<span class="sd">`ToolContainerBase`</span>
<span class="sd">    The base class for the Toolbar class of each interactive backend.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span><span class="p">,</span> <span class="n">suppress</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">IntEnum</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">WeakKeyDictionary</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">backend_tools</span> <span class="k">as</span> <span class="n">tools</span><span class="p">,</span> <span class="n">cbook</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">textpath</span><span class="p">,</span> <span class="n">tight_bbox</span><span class="p">,</span>
    <span class="n">transforms</span><span class="p">,</span> <span class="n">widgets</span><span class="p">,</span> <span class="n">get_backend</span><span class="p">,</span> <span class="n">is_interactive</span><span class="p">,</span> <span class="n">rcParams</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">matplotlib._pylab_helpers</span> <span class="kn">import</span> <span class="n">Gcf</span>
<span class="kn">from</span> <span class="nn">matplotlib.backend_managers</span> <span class="kn">import</span> <span class="n">ToolManager</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="kn">import</span> <span class="n">Affine2D</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="kn">import</span> <span class="n">_setattr_cm</span>


<span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">_default_filetypes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="s1">&#39;Encapsulated Postscript&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpg&#39;</span><span class="p">:</span> <span class="s1">&#39;Joint Photographic Experts Group&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpeg&#39;</span><span class="p">:</span> <span class="s1">&#39;Joint Photographic Experts Group&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="s1">&#39;Portable Document Format&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pgf&#39;</span><span class="p">:</span> <span class="s1">&#39;PGF code for LaTeX&#39;</span><span class="p">,</span>
    <span class="s1">&#39;png&#39;</span><span class="p">:</span> <span class="s1">&#39;Portable Network Graphics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ps&#39;</span><span class="p">:</span> <span class="s1">&#39;Postscript&#39;</span><span class="p">,</span>
    <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;Raw RGBA bitmap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rgba&#39;</span><span class="p">:</span> <span class="s1">&#39;Raw RGBA bitmap&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svg&#39;</span><span class="p">:</span> <span class="s1">&#39;Scalable Vector Graphics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svgz&#39;</span><span class="p">:</span> <span class="s1">&#39;Scalable Vector Graphics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tif&#39;</span><span class="p">:</span> <span class="s1">&#39;Tagged Image File Format&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tiff&#39;</span><span class="p">:</span> <span class="s1">&#39;Tagged Image File Format&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">_default_backends</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;eps&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_ps&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpg&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;jpeg&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_pdf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pgf&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_pgf&#39;</span><span class="p">,</span>
    <span class="s1">&#39;png&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ps&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_ps&#39;</span><span class="p">,</span>
    <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rgba&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svg&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_svg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;svgz&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_svg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tif&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
    <span class="s1">&#39;tiff&#39;</span><span class="p">:</span> <span class="s1">&#39;matplotlib.backends.backend_agg&#39;</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">register_backend</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register a backend for saving to a given file format.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    format : str</span>
<span class="sd">        File extension</span>
<span class="sd">    backend : module string or canvas class</span>
<span class="sd">        Backend for handling file output</span>
<span class="sd">    description : str, default: &quot;&quot;</span>
<span class="sd">        Description of the file type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">_default_backends</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend</span>
    <span class="n">_default_filetypes</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>


<span class="k">def</span> <span class="nf">get_registered_canvas_class</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the registered default canvas for given file format.</span>
<span class="sd">    Handles deferred import of required backend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_default_backends</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">backend_class</span> <span class="o">=</span> <span class="n">_default_backends</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">backend_class</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">backend_class</span> <span class="o">=</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">backend_class</span><span class="p">)</span><span class="o">.</span><span class="n">FigureCanvas</span>
        <span class="n">_default_backends</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span> <span class="o">=</span> <span class="n">backend_class</span>
    <span class="k">return</span> <span class="n">backend_class</span>


<span class="k">class</span> <span class="nc">RendererBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An abstract base class to handle drawing/rendering operations.</span>

<span class="sd">    The following methods must be implemented in the backend for full</span>
<span class="sd">    functionality (though just implementing :meth:`draw_path` alone would</span>
<span class="sd">    give a highly capable backend):</span>

<span class="sd">    * :meth:`draw_path`</span>
<span class="sd">    * :meth:`draw_image`</span>
<span class="sd">    * :meth:`draw_gouraud_triangle`</span>

<span class="sd">    The following methods *should* be implemented in the backend for</span>
<span class="sd">    optimization reasons:</span>

<span class="sd">    * :meth:`draw_text`</span>
<span class="sd">    * :meth:`draw_markers`</span>
<span class="sd">    * :meth:`draw_path_collection`</span>
<span class="sd">    * :meth:`draw_quad_mesh`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span> <span class="o">=</span> <span class="n">textpath</span><span class="o">.</span><span class="n">TextToPath</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">gid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a grouping element with label *s* and *gid* (if set) as id.</span>

<span class="sd">        Only used by the SVG renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">close_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close a grouping element with label *s*.</span>

<span class="sd">        Only used by the SVG renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Draw a `~.path.Path` instance using the given affine transform.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">draw_markers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">marker_path</span><span class="p">,</span> <span class="n">marker_trans</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span>
                     <span class="n">trans</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a marker at each of the vertices in path.</span>

<span class="sd">        This includes all vertices, including control points on curves.</span>
<span class="sd">        To avoid that behavior, those vertices should be removed before</span>
<span class="sd">        calling this function.</span>

<span class="sd">        This provides a fallback implementation of draw_markers that</span>
<span class="sd">        makes multiple calls to :meth:`draw_path`.  Some backends may</span>
<span class="sd">        want to override this method in order to draw the marker only</span>
<span class="sd">        once and reuse it multiple times.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>

<span class="sd">        marker_trans : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform applied to the marker.</span>

<span class="sd">        trans : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform applied to the path.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">codes</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">(</span><span class="n">trans</span><span class="p">,</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">marker_path</span><span class="p">,</span>
                               <span class="n">marker_trans</span> <span class="o">+</span>
                               <span class="n">transforms</span><span class="o">.</span><span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
                               <span class="n">rgbFace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_path_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">,</span>
                             <span class="n">offsets</span><span class="p">,</span> <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">,</span>
                             <span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span> <span class="n">antialiaseds</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span>
                             <span class="n">offset_position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a collection of paths selecting drawing properties from</span>
<span class="sd">        the lists *facecolors*, *edgecolors*, *linewidths*,</span>
<span class="sd">        *linestyles* and *antialiaseds*. *offsets* is a list of</span>
<span class="sd">        offsets to apply to each of the paths.  The offsets in</span>
<span class="sd">        *offsets* are first transformed by *offsetTrans* before being</span>
<span class="sd">        applied.</span>

<span class="sd">        *offset_position* may be either &quot;screen&quot; or &quot;data&quot; depending on the</span>
<span class="sd">        space that the offsets are in; &quot;data&quot; is deprecated.</span>

<span class="sd">        This provides a fallback implementation of</span>
<span class="sd">        :meth:`draw_path_collection` that makes multiple calls to</span>
<span class="sd">        :meth:`draw_path`.  Some backends may want to override this in</span>
<span class="sd">        order to render each set of path data only once, and then</span>
<span class="sd">        reference that path multiple times with the different offsets,</span>
<span class="sd">        colors, styles etc.  The generator methods</span>
<span class="sd">        :meth:`_iter_collection_raw_paths` and</span>
<span class="sd">        :meth:`_iter_collection` are provided to help with (and</span>
<span class="sd">        standardize) the implementation across backends.  It is highly</span>
<span class="sd">        recommended to use those generators, so that changes to the</span>
<span class="sd">        behavior of :meth:`draw_path_collection` can be made globally.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_collection_raw_paths</span><span class="p">(</span><span class="n">master_transform</span><span class="p">,</span>
                                                   <span class="n">paths</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="n">path_id</span><span class="p">,</span> <span class="n">gc0</span><span class="p">,</span> <span class="n">rgbFace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter_collection</span><span class="p">(</span>
                <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">path_ids</span><span class="p">),</span> <span class="n">offsets</span><span class="p">,</span>
                <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span>
                <span class="n">antialiaseds</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">offset_position</span><span class="p">):</span>
            <span class="n">path</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="n">path_id</span>
            <span class="c1"># Only apply another translation if we have an offset, else we</span>
            <span class="c1"># resuse the inital transform.</span>
            <span class="k">if</span> <span class="n">xo</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">yo</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># The transformation can be used by multiple paths. Since</span>
                <span class="c1"># translate is a inplace operation, we need to copy the</span>
                <span class="c1"># transformation by .frozen() before applying the translation.</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
                <span class="n">transform</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc0</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_quad_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">meshWidth</span><span class="p">,</span> <span class="n">meshHeight</span><span class="p">,</span>
                       <span class="n">coordinates</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span>
                       <span class="n">antialiased</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fallback implementation of :meth:`draw_quad_mesh` that generates paths</span>
<span class="sd">        and then calls :meth:`draw_path_collection`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">QuadMesh</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="n">QuadMesh</span><span class="o">.</span><span class="n">convert_mesh_to_paths</span><span class="p">(</span>
            <span class="n">meshWidth</span><span class="p">,</span> <span class="n">meshHeight</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">edgecolors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">edgecolors</span> <span class="o">=</span> <span class="n">facecolors</span>
        <span class="n">linewidths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">gc</span><span class="o">.</span><span class="n">get_linewidth</span><span class="p">()],</span> <span class="nb">float</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_path_collection</span><span class="p">(</span>
            <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="p">[],</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span>
            <span class="n">edgecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span> <span class="p">[],</span> <span class="p">[</span><span class="n">antialiased</span><span class="p">],</span> <span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="s1">&#39;screen&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_gouraud_triangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">points</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">transform</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a Gouraud-shaded triangle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>

<span class="sd">        points : array-like, shape=(3, 2)</span>
<span class="sd">            Array of (x, y) points for the triangle.</span>

<span class="sd">        colors : array-like, shape=(3, 4)</span>
<span class="sd">            RGBA colors for each point of the triangle.</span>

<span class="sd">        transform : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform to apply to the points.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">draw_gouraud_triangles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">triangles_array</span><span class="p">,</span> <span class="n">colors_array</span><span class="p">,</span>
                               <span class="n">transform</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a series of Gouraud triangles.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : array-like, shape=(N, 3, 2)</span>
<span class="sd">            Array of *N* (x, y) points for the triangles.</span>

<span class="sd">        colors : array-like, shape=(N, 3, 4)</span>
<span class="sd">            Array of *N* RGBA colors for each point of the triangles.</span>

<span class="sd">        transform : `matplotlib.transforms.Transform`</span>
<span class="sd">            An affine transform to apply to the points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">frozen</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tri</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">triangles_array</span><span class="p">,</span> <span class="n">colors_array</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw_gouraud_triangle</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">tri</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iter_collection_raw_paths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span>
                                   <span class="n">all_transforms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method (along with :meth:`_iter_collection`) to implement</span>
<span class="sd">        :meth:`draw_path_collection` in a space-efficient manner.</span>

<span class="sd">        This method yields all of the base path/transform</span>
<span class="sd">        combinations, given a master transform, a list of paths and</span>
<span class="sd">        list of transforms.</span>

<span class="sd">        The arguments should be exactly what is passed in to</span>
<span class="sd">        :meth:`draw_path_collection`.</span>

<span class="sd">        The backend should take each yielded path and transform and</span>
<span class="sd">        create an object that can be referenced (reused) later.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="n">Ntransforms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span> <span class="n">Ntransforms</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Npaths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">IdentityTransform</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">paths</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Npaths</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Ntransforms</span><span class="p">:</span>
                <span class="n">transform</span> <span class="o">=</span> <span class="n">Affine2D</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Ntransforms</span><span class="p">])</span>
            <span class="k">yield</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span> <span class="o">+</span> <span class="n">master_transform</span>

    <span class="k">def</span> <span class="nf">_iter_collection_uses_per_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">,</span>
                                       <span class="n">offsets</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span> <span class="n">edgecolors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute how many times each raw path object returned by</span>
<span class="sd">        _iter_collection_raw_paths would be used when calling</span>
<span class="sd">        _iter_collection. This is intended for the backend to decide</span>
<span class="sd">        on the tradeoff between using the paths in-line and storing</span>
<span class="sd">        them once and reusing. Rounds up in case the number of uses</span>
<span class="sd">        is not the same for every path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Npaths</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">facecolors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgecolors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">Npath_ids</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npath_ids</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="n">Npath_ids</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">Npath_ids</span>

    <span class="k">def</span> <span class="nf">_iter_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">master_transform</span><span class="p">,</span> <span class="n">all_transforms</span><span class="p">,</span>
                         <span class="n">path_ids</span><span class="p">,</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">offsetTrans</span><span class="p">,</span> <span class="n">facecolors</span><span class="p">,</span>
                         <span class="n">edgecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="p">,</span>
                         <span class="n">antialiaseds</span><span class="p">,</span> <span class="n">urls</span><span class="p">,</span> <span class="n">offset_position</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helper method (along with :meth:`_iter_collection_raw_paths`) to</span>
<span class="sd">        implement :meth:`draw_path_collection` in a space-efficient manner.</span>

<span class="sd">        This method yields all of the path, offset and graphics</span>
<span class="sd">        context combinations to draw the path collection.  The caller</span>
<span class="sd">        should already have looped over the results of</span>
<span class="sd">        :meth:`_iter_collection_raw_paths` to draw this collection.</span>

<span class="sd">        The arguments should be the same as that passed into</span>
<span class="sd">        :meth:`draw_path_collection`, with the exception of</span>
<span class="sd">        *path_ids*, which is a list of arbitrary objects that the</span>
<span class="sd">        backend will use to reference one of the paths created in the</span>
<span class="sd">        :meth:`_iter_collection_raw_paths` stage.</span>

<span class="sd">        Each yielded result is of the form::</span>

<span class="sd">           xo, yo, path_id, gc, rgbFace</span>

<span class="sd">        where *xo*, *yo* is an offset; *path_id* is one of the elements of</span>
<span class="sd">        *path_ids*; *gc* is a graphics context and *rgbFace* is a color to</span>
<span class="sd">        use for filling the path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Ntransforms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">)</span>
        <span class="n">Npaths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">path_ids</span><span class="p">)</span>
        <span class="n">Noffsets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Npaths</span><span class="p">,</span> <span class="n">Noffsets</span><span class="p">)</span>
        <span class="n">Nfacecolors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">facecolors</span><span class="p">)</span>
        <span class="n">Nedgecolors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgecolors</span><span class="p">)</span>
        <span class="n">Nlinewidths</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linewidths</span><span class="p">)</span>
        <span class="n">Nlinestyles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">linestyles</span><span class="p">)</span>
        <span class="n">Naa</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">antialiaseds</span><span class="p">)</span>
        <span class="n">Nurls</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">urls</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">offset_position</span> <span class="o">==</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span>
            <span class="n">cbook</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Support for offset_position=&#39;data&#39; is &quot;</span>
                <span class="s2">&quot;deprecated since </span><span class="si">%(since)s</span><span class="s2"> and will be removed </span><span class="si">%(removal)s</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">Nfacecolors</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">Nedgecolors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">Npaths</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">Noffsets</span><span class="p">:</span>
            <span class="n">toffsets</span> <span class="o">=</span> <span class="n">offsetTrans</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">offsets</span><span class="p">)</span>

        <span class="n">gc0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>
        <span class="n">gc0</span><span class="o">.</span><span class="n">copy_properties</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Nfacecolors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rgbFace</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">Nedgecolors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gc0</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">path_id</span> <span class="o">=</span> <span class="n">path_ids</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Npaths</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Noffsets</span><span class="p">:</span>
                <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span> <span class="o">=</span> <span class="n">toffsets</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Noffsets</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">offset_position</span> <span class="o">==</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Ntransforms</span><span class="p">:</span>
                        <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">Affine2D</span><span class="p">(</span><span class="n">all_transforms</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Ntransforms</span><span class="p">])</span> <span class="o">+</span>
                            <span class="n">master_transform</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">transform</span> <span class="o">=</span> <span class="n">master_transform</span>
                    <span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">),</span> <span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span>
                        <span class="p">[(</span><span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
                    <span class="n">xo</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">xp</span> <span class="o">-</span> <span class="n">xo</span><span class="p">)</span>
                    <span class="n">yo</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">yp</span> <span class="o">-</span> <span class="n">yo</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">yo</span><span class="p">)):</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">Nfacecolors</span><span class="p">:</span>
                <span class="n">rgbFace</span> <span class="o">=</span> <span class="n">facecolors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Nfacecolors</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Nedgecolors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">Nlinewidths</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">linewidths</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Nlinewidths</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">Nlinestyles</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="o">*</span><span class="n">linestyles</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Nlinestyles</span><span class="p">])</span>
                <span class="n">fg</span> <span class="o">=</span> <span class="n">edgecolors</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Nedgecolors</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                        <span class="n">gc0</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">gc0</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">gc0</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rgbFace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgbFace</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">rgbFace</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rgbFace</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">gc0</span><span class="o">.</span><span class="n">set_antialiased</span><span class="p">(</span><span class="n">antialiaseds</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Naa</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">Nurls</span><span class="p">:</span>
                <span class="n">gc0</span><span class="o">.</span><span class="n">set_url</span><span class="p">(</span><span class="n">urls</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="n">Nurls</span><span class="p">])</span>

            <span class="k">yield</span> <span class="n">xo</span><span class="p">,</span> <span class="n">yo</span><span class="p">,</span> <span class="n">path_id</span><span class="p">,</span> <span class="n">gc0</span><span class="p">,</span> <span class="n">rgbFace</span>
        <span class="n">gc0</span><span class="o">.</span><span class="n">restore</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_image_magnification</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the factor by which to magnify images passed to :meth:`draw_image`.</span>
<span class="sd">        Allows a backend to have images at a different resolution to other</span>
<span class="sd">        artists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">draw_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">im</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw an RGBA image.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            A graphics context with clipping information.</span>

<span class="sd">        x : scalar</span>
<span class="sd">            The distance in physical units (i.e., dots or pixels) from the left</span>
<span class="sd">            hand side of the canvas.</span>

<span class="sd">        y : scalar</span>
<span class="sd">            The distance in physical units (i.e., dots or pixels) from the</span>
<span class="sd">            bottom side of the canvas.</span>

<span class="sd">        im : array-like, shape=(N, M, 4), dtype=np.uint8</span>
<span class="sd">            An array of RGBA pixels.</span>

<span class="sd">        transform : `matplotlib.transforms.Affine2DBase`</span>
<span class="sd">            If and only if the concrete backend is written such that</span>
<span class="sd">            :meth:`option_scale_image` returns ``True``, an affine</span>
<span class="sd">            transformation (i.e., an `.Affine2DBase`) *may* be passed to</span>
<span class="sd">            :meth:`draw_image`.  The translation vector of the transformation</span>
<span class="sd">            is given in physical units (i.e., dots or pixels). Note that</span>
<span class="sd">            the transformation does not override *x* and *y*, and has to be</span>
<span class="sd">            applied *before* translating the result by *x* and *y* (this can</span>
<span class="sd">            be accomplished by adding *x* and *y* to the translation vector</span>
<span class="sd">            defined by *transform*).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">option_image_nocomposite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether image composition by Matplotlib should be skipped.</span>

<span class="sd">        Raster backends should usually return False (letting the C-level</span>
<span class="sd">        rasterizer take care of image composition); vector backends should</span>
<span class="sd">        usually return ``not rcParams[&quot;image.composite_image&quot;]``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">option_scale_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether arbitrary affine transformations in :meth:`draw_image`</span>
<span class="sd">        are supported (True for most vector backends).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">_delete_parameter</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="s2">&quot;ismath&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">draw_tex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="s1">&#39;TeX!&#39;</span><span class="p">,</span> <span class="n">mtext</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text_as_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="s2">&quot;TeX&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mtext</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the text instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        gc : `.GraphicsContextBase`</span>
<span class="sd">            The graphics context.</span>
<span class="sd">        x : float</span>
<span class="sd">            The x location of the text in display coords.</span>
<span class="sd">        y : float</span>
<span class="sd">            The y location of the text baseline in display coords.</span>
<span class="sd">        s : str</span>
<span class="sd">            The text string.</span>
<span class="sd">        prop : `matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font properties.</span>
<span class="sd">        angle : float</span>
<span class="sd">            The rotation angle in degrees anti-clockwise.</span>
<span class="sd">        mtext : `matplotlib.text.Text`</span>
<span class="sd">            The original text object to be rendered.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        **Note for backend implementers:**</span>

<span class="sd">        When you are trying to determine if you have gotten your bounding box</span>
<span class="sd">        right (which is what enables the text layout/alignment to work</span>
<span class="sd">        properly), it helps to change the line in text.py::</span>

<span class="sd">            if 0: bbox_artist(self, renderer)</span>

<span class="sd">        to if 1, and then the actual bounding box will be plotted along with</span>
<span class="sd">        your text.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_text_as_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_text_path_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the text path and transform.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : `matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font property.</span>
<span class="sd">        s : str</span>
<span class="sd">            The text to be converted.</span>
<span class="sd">        ismath : bool or &quot;TeX&quot;</span>
<span class="sd">            If True, use mathtext parser. If &quot;TeX&quot;, use *usetex* mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">text2path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">())</span>
        <span class="n">verts</span><span class="p">,</span> <span class="n">codes</span> <span class="o">=</span> <span class="n">text2path</span><span class="o">.</span><span class="n">get_text_path</span><span class="p">(</span><span class="n">prop</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ismath</span><span class="o">=</span><span class="n">ismath</span><span class="p">)</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">verts</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flipy</span><span class="p">():</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_canvas_width_height</span><span class="p">()</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">Affine2D</span><span class="p">()</span>
                         <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">/</span> <span class="n">text2path</span><span class="o">.</span><span class="n">FONT_SCALE</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="p">(</span><span class="n">Affine2D</span><span class="p">()</span>
                         <span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">/</span> <span class="n">text2path</span><span class="o">.</span><span class="n">FONT_SCALE</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">rotate</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                         <span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span>

    <span class="k">def</span> <span class="nf">_draw_text_as_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the text by converting them to paths using textpath module.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prop : `matplotlib.font_manager.FontProperties`</span>
<span class="sd">            The font property.</span>
<span class="sd">        s : str</span>
<span class="sd">            The text to be converted.</span>
<span class="sd">        usetex : bool</span>
<span class="sd">            Whether to use usetex mode.</span>
<span class="sd">        ismath : bool or &quot;TeX&quot;</span>
<span class="sd">            If True, use mathtext parser. If &quot;TeX&quot;, use *usetex* mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span><span class="p">,</span> <span class="n">transform</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_path_transform</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">()</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_path</span><span class="p">(</span><span class="n">gc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_text_width_height_descent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the width, height, and descent (offset from the bottom</span>
<span class="sd">        to the baseline), in display coords, of the string *s* with</span>
<span class="sd">        `.FontProperties` *prop*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ismath</span> <span class="o">==</span> <span class="s1">&#39;TeX&#39;</span><span class="p">:</span>
            <span class="c1"># todo: handle props</span>
            <span class="n">texmanager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">get_texmanager</span><span class="p">()</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">()</span>
            <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">texmanager</span><span class="o">.</span><span class="n">get_text_width_height_descent</span><span class="p">(</span>
                <span class="n">s</span><span class="p">,</span> <span class="n">fontsize</span><span class="p">,</span> <span class="n">renderer</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span>

        <span class="n">dpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="mi">72</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ismath</span><span class="p">:</span>
            <span class="n">dims</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">mathtext_parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dims</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># return width, height, descent</span>

        <span class="n">flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">_get_hinting_flag</span><span class="p">()</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text2path</span><span class="o">.</span><span class="n">_get_font</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">set_size</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dpi</span><span class="p">)</span>
        <span class="c1"># the width and height of unrotated string</span>
        <span class="n">font</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">font</span><span class="o">.</span><span class="n">get_descent</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">/=</span> <span class="mf">64.0</span>  <span class="c1"># convert from subpixels</span>
        <span class="n">h</span> <span class="o">/=</span> <span class="mf">64.0</span>
        <span class="n">d</span> <span class="o">/=</span> <span class="mf">64.0</span>
        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">flipy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether y values increase from top to bottom.</span>

<span class="sd">        Note that this only affects drawing of texts and images.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_canvas_width_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the canvas width and height in display coords.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">get_texmanager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the `.TexManager` instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">matplotlib.texmanager</span> <span class="kn">import</span> <span class="n">TexManager</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span> <span class="o">=</span> <span class="n">TexManager</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_texmanager</span>

    <span class="k">def</span> <span class="nf">new_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return an instance of a `.GraphicsContextBase`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">GraphicsContextBase</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">points_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert points to display units.</span>

<span class="sd">        You need to override this function (unless your backend</span>
<span class="sd">        doesn&#39;t have a dpi, e.g., postscript or svg).  Some imaging</span>
<span class="sd">        systems assume some value for pixels per inch::</span>

<span class="sd">            points to pixels = points * pixels_per_inch/72 * dpi/72</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        points : float or array-like</span>
<span class="sd">            a float or a numpy array of float</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Points converted to pixels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">points</span>

    <span class="k">def</span> <span class="nf">start_rasterizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch to the raster renderer.</span>

<span class="sd">        Used by `.MixedModeRenderer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">stop_rasterizing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch back to the vector renderer and draw the contents of the raster</span>
<span class="sd">        renderer as an image on the vector renderer.</span>

<span class="sd">        Used by `.MixedModeRenderer`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">start_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch to a temporary renderer for image filtering effects.</span>

<span class="sd">        Currently only supported by the agg renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">stop_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filter_func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switch back to the original renderer.  The contents of the temporary</span>
<span class="sd">        renderer is processed with the *filter_func* and is drawn on the</span>
<span class="sd">        original renderer as an image.</span>

<span class="sd">        Currently only supported by the agg renderer.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_draw_disabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Context manager to temporary disable drawing.</span>

<span class="sd">        This is used for getting the drawn size of Artists.  This lets us</span>
<span class="sd">        run the draw process to update any Python state but does not pay the</span>
<span class="sd">        cost of the draw_XYZ calls on the canvas.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">no_ops</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">meth_name</span><span class="p">:</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">meth_name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">RendererBase</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">meth_name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;draw_&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="n">meth_name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;open_group&quot;</span><span class="p">,</span> <span class="s2">&quot;close_group&quot;</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">no_ops</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">GraphicsContextBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;An abstract base class that provides color, line styles, etc.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># if True, _alpha overrides A from RGBA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># use 0, 1 not True, False for extension code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="s1">&#39;butt&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linestyle</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.color&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_linewidth</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;hatch.linewidth&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">copy_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copy properties from *gc* to self.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_forced_alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_antialiased</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_capstyle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_cliprect</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_clippath</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_dashes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_joinstyle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linestyle</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_linestyle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_rgb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_hatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_hatch_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_linewidth</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_hatch_linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_gid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_snap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">_sketch</span>

    <span class="k">def</span> <span class="nf">restore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the graphics context from the stack - needed only</span>
<span class="sd">        for backends that save graphics contexts on a stack.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the alpha value used for blending - not supported on all</span>
<span class="sd">        backends.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span>

    <span class="k">def</span> <span class="nf">get_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return whether the object should try to do antialiased rendering.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span>

    <span class="k">def</span> <span class="nf">get_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the capstyle as a string in (&#39;butt&#39;, &#39;round&#39;, &#39;projecting&#39;).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span>

    <span class="k">def</span> <span class="nf">get_clip_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the clip rectangle as a `~matplotlib.transforms.Bbox` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span>

    <span class="k">def</span> <span class="nf">get_clip_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the clip path in the form (path, transform), where path</span>
<span class="sd">        is a `~.path.Path` instance, and transform is</span>
<span class="sd">        an affine transform to apply to the path before clipping.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span><span class="o">.</span><span class="n">get_transformed_path_and_affine</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_dashes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the dash style as an (offset, dash-list) pair.</span>

<span class="sd">        The dash list is a even-length list that gives the ink on, ink off in</span>
<span class="sd">        points.  See p. 107 of to PostScript `blue book`_ for more info.</span>

<span class="sd">        Default value is (None, None).</span>

<span class="sd">        .. _blue book: https://www-cdf.fnal.gov/offline/PostScript/BLUEBOOK.PDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span>

    <span class="k">def</span> <span class="nf">get_forced_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether the value given by get_alpha() should be used to</span>
<span class="sd">        override any other alpha-channel values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span>

    <span class="k">def</span> <span class="nf">get_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the line join style as one of (&#39;miter&#39;, &#39;round&#39;, &#39;bevel&#39;).&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span>

    <span class="k">def</span> <span class="nf">get_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the line width in points.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span>

    <span class="k">def</span> <span class="nf">get_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a tuple of three or four floats from 0-1.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span>

    <span class="k">def</span> <span class="nf">get_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a url if one is set, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_url</span>

    <span class="k">def</span> <span class="nf">get_gid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the object identifier if one is set, None otherwise.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span>

    <span class="k">def</span> <span class="nf">get_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the snap setting, which can be:</span>

<span class="sd">        * True: snap vertices to the nearest pixel center</span>
<span class="sd">        * False: leave vertices as-is</span>
<span class="sd">        * None: (auto) If the path contains only rectilinear line segments,</span>
<span class="sd">          round to the nearest pixel center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span>

    <span class="k">def</span> <span class="nf">set_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">alpha</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the alpha value used for blending - not supported on all backends.</span>

<span class="sd">        If ``alpha=None`` (the default), the alpha components of the</span>
<span class="sd">        foreground and fill colors will be used to set their respective</span>
<span class="sd">        transparencies (where applicable); otherwise, ``alpha`` will override</span>
<span class="sd">        them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alpha</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="n">alpha</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span><span class="p">,</span> <span class="n">isRGBA</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_antialiased</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set whether object should be drawn with antialiased rendering.&quot;&quot;&quot;</span>
        <span class="c1"># Use ints to make life easier on extension code trying to read the gc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_antialiased</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the capstyle to be one of (&#39;butt&#39;, &#39;round&#39;, &#39;projecting&#39;).&quot;&quot;&quot;</span>
        <span class="n">cbook</span><span class="o">.</span><span class="n">_check_in_list</span><span class="p">([</span><span class="s1">&#39;butt&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;projecting&#39;</span><span class="p">],</span> <span class="n">cs</span><span class="o">=</span><span class="n">cs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span> <span class="o">=</span> <span class="n">cs</span>

    <span class="k">def</span> <span class="nf">set_clip_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rectangle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the clip rectangle with sequence (left, bottom, width, height)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cliprect</span> <span class="o">=</span> <span class="n">rectangle</span>

    <span class="k">def</span> <span class="nf">set_clip_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the clip path and transformation.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : `~matplotlib.transforms.TransformedPath` or None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cbook</span><span class="o">.</span><span class="n">_check_isinstance</span><span class="p">((</span><span class="n">transforms</span><span class="o">.</span><span class="n">TransformedPath</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clippath</span> <span class="o">=</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">set_dashes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dash_offset</span><span class="p">,</span> <span class="n">dash_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the dash style for the gc.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dash_offset : float or None</span>
<span class="sd">            The offset (usually 0).</span>
<span class="sd">        dash_list : array-like or None</span>
<span class="sd">            The on-off sequence as points.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        ``(None, None)`` specifies a solid line.</span>

<span class="sd">        See p. 107 of to PostScript `blue book`_ for more info.</span>

<span class="sd">        .. _blue book: https://www-cdf.fnal.gov/offline/PostScript/BLUEBOOK.PDF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dash_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dash_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dl</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;All values in the dash list must be positive&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dashes</span> <span class="o">=</span> <span class="n">dash_offset</span><span class="p">,</span> <span class="n">dash_list</span>

    <span class="k">def</span> <span class="nf">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">isRGBA</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the foreground color.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fg : color</span>
<span class="sd">        isRGBA : bool</span>
<span class="sd">            If *fg* is known to be an ``(r, g, b, a)`` tuple, *isRGBA* can be</span>
<span class="sd">            set to True to improve performance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span> <span class="ow">and</span> <span class="n">isRGBA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">fg</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">,)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forced_alpha</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">fg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alpha</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">isRGBA</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">fg</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rgb</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">fg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">js</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the join style to be one of (&#39;miter&#39;, &#39;round&#39;, &#39;bevel&#39;).&quot;&quot;&quot;</span>
        <span class="n">cbook</span><span class="o">.</span><span class="n">_check_in_list</span><span class="p">([</span><span class="s1">&#39;miter&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;bevel&#39;</span><span class="p">],</span> <span class="n">js</span><span class="o">=</span><span class="n">js</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span> <span class="o">=</span> <span class="n">js</span>

    <span class="k">def</span> <span class="nf">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the linewidth in points.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the url for links in compatible backends.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_url</span> <span class="o">=</span> <span class="n">url</span>

    <span class="k">def</span> <span class="nf">set_gid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the id.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gid</span> <span class="o">=</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">set_snap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">snap</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the snap setting which may be:</span>

<span class="sd">        * True: snap vertices to the nearest pixel center</span>
<span class="sd">        * False: leave vertices as-is</span>
<span class="sd">        * None: (auto) If the path contains only rectilinear line segments,</span>
<span class="sd">          round to the nearest pixel center</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_snap</span> <span class="o">=</span> <span class="n">snap</span>

    <span class="k">def</span> <span class="nf">set_hatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hatch</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the hatch style (for fills).&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span> <span class="o">=</span> <span class="n">hatch</span>

    <span class="k">def</span> <span class="nf">get_hatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the current hatch style.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch</span>

    <span class="k">def</span> <span class="nf">get_hatch_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="mf">6.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a `.Path` for the current hatch.&quot;&quot;&quot;</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hatch</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">hatch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">Path</span><span class="o">.</span><span class="n">hatch</span><span class="p">(</span><span class="n">hatch</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_hatch_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the hatch color.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span>

    <span class="k">def</span> <span class="nf">set_hatch_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hatch_color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the hatch color.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_color</span> <span class="o">=</span> <span class="n">hatch_color</span>

    <span class="k">def</span> <span class="nf">get_hatch_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the hatch linewidth.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hatch_linewidth</span>

    <span class="k">def</span> <span class="nf">get_sketch_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the sketch parameters for the artist.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple or `None`</span>

<span class="sd">            A 3-tuple with the following elements:</span>

<span class="sd">            * ``scale``: The amplitude of the wiggle perpendicular to the</span>
<span class="sd">              source line.</span>
<span class="sd">            * ``length``: The length of the wiggle along the line.</span>
<span class="sd">            * ``randomness``: The scale factor by which the length is</span>
<span class="sd">              shrunken or expanded.</span>

<span class="sd">            May return `None` if no sketch parameters were set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span>

    <span class="k">def</span> <span class="nf">set_sketch_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">randomness</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the sketch parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale : float, optional</span>
<span class="sd">            The amplitude of the wiggle perpendicular to the source line, in</span>
<span class="sd">            pixels.  If scale is `None`, or not provided, no sketch filter will</span>
<span class="sd">            be provided.</span>
<span class="sd">        length : float, default: 128</span>
<span class="sd">             The length of the wiggle along the line, in pixels.</span>
<span class="sd">        randomness : float, default: 16</span>
<span class="sd">            The scale factor by which the length is shrunken or expanded.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sketch</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">else</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">length</span> <span class="ow">or</span> <span class="mf">128.</span><span class="p">,</span> <span class="n">randomness</span> <span class="ow">or</span> <span class="mf">16.</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">TimerBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A base class for providing timer events, useful for things animations.</span>
<span class="sd">    Backends need to implement a few specific methods in order to use their</span>
<span class="sd">    own timing mechanisms so that the timer events are integrated into their</span>
<span class="sd">    event loops.</span>

<span class="sd">    Subclasses must override the following methods:</span>

<span class="sd">    - ``_timer_start``: Backend-specific code for starting the timer.</span>
<span class="sd">    - ``_timer_stop``: Backend-specific code for stopping the timer.</span>

<span class="sd">    Subclasses may additionally override the following methods:</span>

<span class="sd">    - ``_timer_set_single_shot``: Code for setting the timer to single shot</span>
<span class="sd">      operating mode, if supported by the timer object.  If not, the `Timer`</span>
<span class="sd">      class itself will store the flag and the ``_on_timer`` method should be</span>
<span class="sd">      overridden to support such behavior.</span>

<span class="sd">    - ``_timer_set_interval``: Code for setting the interval on the timer, if</span>
<span class="sd">      there is a method for doing so on the timer object.</span>

<span class="sd">    - ``_on_timer``: The internal function that any timer object should call,</span>
<span class="sd">      which will handle the task of running all callbacks that have been set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interval : int, default: 1000ms</span>
<span class="sd">            The time between timer events in milliseconds.  Will be stored as</span>
<span class="sd">            ``timer.interval``.</span>
<span class="sd">        callbacks : List[Tuple[callable, Tuple, Dict]]</span>
<span class="sd">            List of (func, args, kwargs) tuples that will be called upon</span>
<span class="sd">            timer events.  This list is accessible as ``timer.callbacks`` and</span>
<span class="sd">            can be manipulated directly, or the functions `add_callback` and</span>
<span class="sd">            `remove_callback` can be used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">callbacks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">callbacks</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="c1"># Set .interval and not ._interval to go through the property setter.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">1000</span> <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">single_shot</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Need to stop timer and possibly disconnect timer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the timer object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interval : int, optional</span>
<span class="sd">            Timer interval in milliseconds; overrides a previously set interval</span>
<span class="sd">            if provided.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stop the timer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_timer_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_timer_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The time between timer events, in milliseconds.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span>

    <span class="nd">@interval</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">interval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">):</span>
        <span class="c1"># Force to int since none of the backends actually support fractional</span>
        <span class="c1"># milliseconds, and some error or give warnings.</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interval</span> <span class="o">=</span> <span class="n">interval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_set_interval</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether this timer should stop after a single run.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single</span>

    <span class="nd">@single_shot</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ss</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_single</span> <span class="o">=</span> <span class="n">ss</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_set_single_shot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">add_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register *func* to be called by timer when the event fires. Any</span>
<span class="sd">        additional arguments provided will be passed to *func*.</span>

<span class="sd">        This function returns *func*, which makes it possible to use it as a</span>
<span class="sd">        decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">remove_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove *func* from list of callbacks.</span>

<span class="sd">        *args* and *kwargs* are optional and used to distinguish between copies</span>
<span class="sd">        of the same function registered to be called with different arguments.</span>
<span class="sd">        This behavior is deprecated.  In the future, ``*args, **kwargs`` won&#39;t</span>
<span class="sd">        be considered anymore; to keep a specific callback removable by itself,</span>
<span class="sd">        pass it to `add_callback` as a `functools.partial` object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">cbook</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s2">&quot;3.1&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;In a future version, Timer.remove_callback &quot;</span>
                <span class="s2">&quot;will not take *args, **kwargs anymore, but remove all &quot;</span>
                <span class="s2">&quot;callbacks where the callable matches; to keep a specific &quot;</span>
                <span class="s2">&quot;callback removable by itself, pass it to add_callback as a &quot;</span>
                <span class="s2">&quot;functools.partial object.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">funcs</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">funcs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">funcs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">func</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_timer_set_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used to set interval on underlying timer object.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_timer_set_single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used to set single shot on underlying timer object.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_on_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs all function that have been registered as callbacks. Functions</span>
<span class="sd">        can return False (or 0) if they should not be called any more. If there</span>
<span class="sd">        are no callbacks, the timer is automatically stopped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c1"># docstring above explains why we use `if ret == 0` here,</span>
            <span class="c1"># instead of `if not ret`.</span>
            <span class="c1"># This will also catch `ret == False` as `False == 0`</span>
            <span class="c1"># but does not annoy the linters</span>
            <span class="c1"># https://docs.python.org/3/library/stdtypes.html#boolean-values</span>
            <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">Event</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Matplotlib event.  Attach additional attributes as defined in</span>
<span class="sd">    :meth:`FigureCanvasBase.mpl_connect`.  The following attributes</span>
<span class="sd">    are defined and shown with their default values</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The event name.</span>
<span class="sd">    canvas : `FigureCanvasBase`</span>
<span class="sd">        The backend-specific canvas instance generating the event.</span>
<span class="sd">    guiEvent</span>
<span class="sd">        The GUI event that triggered the Matplotlib event.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guiEvent</span> <span class="o">=</span> <span class="n">guiEvent</span>


<span class="k">class</span> <span class="nc">DrawEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An event triggered by a draw operation on the canvas</span>

<span class="sd">    In most backends callbacks subscribed to this callback will be</span>
<span class="sd">    fired after the rendering is complete but before the screen is</span>
<span class="sd">    updated.  Any extra artists drawn to the canvas&#39;s renderer will</span>
<span class="sd">    be reflected without an explicit call to ``blit``.</span>

<span class="sd">    .. warning::</span>

<span class="sd">       Calling ``canvas.draw`` and ``canvas.blit`` in these callbacks may</span>
<span class="sd">       not be safe with all backends and may cause infinite recursion.</span>

<span class="sd">    In addition to the `Event` attributes, the following event</span>
<span class="sd">    attributes are defined:</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    renderer : `RendererBase`</span>
<span class="sd">        The renderer for the draw event.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="n">Event</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="n">renderer</span>


<span class="k">class</span> <span class="nc">ResizeEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An event triggered by a canvas resize</span>

<span class="sd">    In addition to the `Event` attributes, the following event</span>
<span class="sd">    attributes are defined:</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    width : int</span>
<span class="sd">        Width of the canvas in pixels.</span>
<span class="sd">    height : int</span>
<span class="sd">        Height of the canvas in pixels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="n">Event</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">get_width_height</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">CloseEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An event triggered by a figure being closed.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">LocationEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An event that has a screen location.</span>

<span class="sd">    The following additional attributes are defined and shown with</span>
<span class="sd">    their default values.</span>

<span class="sd">    In addition to the `Event` attributes, the following</span>
<span class="sd">    event attributes are defined:</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    x : int</span>
<span class="sd">        x position - pixels from left of canvas.</span>
<span class="sd">    y : int</span>
<span class="sd">        y position - pixels from bottom of canvas.</span>
<span class="sd">    inaxes : `~.axes.Axes` or None</span>
<span class="sd">        The `~.axes.Axes` instance over which the mouse is, if any.</span>
<span class="sd">    xdata : float or None</span>
<span class="sd">        x data coordinate of the mouse.</span>
<span class="sd">    ydata : float or None</span>
<span class="sd">        y data coordinate of the mouse.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lastevent</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the last event that was triggered before this one</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (*x*, *y*) in figure coords ((0, 0) = bottom left).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Event</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="c1"># x position - pixels from left of canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">x</span>
        <span class="c1"># y position - pixels from right of canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the Axes instance if mouse us over axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># x coord of mouse in data coords</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="kc">None</span>   <span class="c1"># y coord of mouse in data coords</span>

        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># cannot check if event was in axes if no (x, y) info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_enter_leave</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">inaxes</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mouse_grabber</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">transData</span><span class="o">.</span><span class="n">inverted</span><span class="p">()</span>
                <span class="n">xdata</span><span class="p">,</span> <span class="n">ydata</span> <span class="o">=</span> <span class="n">trans</span><span class="o">.</span><span class="n">transform</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xdata</span> <span class="o">=</span> <span class="n">xdata</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ydata</span> <span class="o">=</span> <span class="n">ydata</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_enter_leave</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_enter_leave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Process the figure/axes enter leave events.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span>
            <span class="k">if</span> <span class="n">last</span><span class="o">.</span><span class="n">inaxes</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span><span class="p">:</span>
                <span class="c1"># process axes enter/leave events</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">last</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">last</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;axes_leave_event&#39;</span><span class="p">,</span> <span class="n">last</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                    <span class="c1"># See ticket 2901582.</span>
                    <span class="c1"># I think this is a valid exception to the rule</span>
                    <span class="c1"># against catching all exceptions; if anything goes</span>
                    <span class="c1"># wrong, we simply want to move on and process the</span>
                    <span class="c1"># current event.</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;axes_enter_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># process a figure enter event</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;axes_enter_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span> <span class="o">=</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">MouseButton</span><span class="p">(</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">LEFT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">MIDDLE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">RIGHT</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">BACK</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">FORWARD</span> <span class="o">=</span> <span class="mi">9</span>


<span class="k">class</span> <span class="nc">MouseEvent</span><span class="p">(</span><span class="n">LocationEvent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mouse event (&#39;button_press_event&#39;,</span>
<span class="sd">                   &#39;button_release_event&#39;,</span>
<span class="sd">                   &#39;scroll_event&#39;,</span>
<span class="sd">                   &#39;motion_notify_event&#39;).</span>

<span class="sd">    In addition to the `Event` and `LocationEvent`</span>
<span class="sd">    attributes, the following attributes are defined:</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    button : None or `MouseButton` or {&#39;up&#39;, &#39;down&#39;}</span>
<span class="sd">        The button pressed. &#39;up&#39; and &#39;down&#39; are used for scroll events.</span>
<span class="sd">        Note that in the nbagg backend, both the middle and right clicks</span>
<span class="sd">        return RIGHT since right clicking will bring up the context menu in</span>
<span class="sd">        some browsers.</span>
<span class="sd">        Note that LEFT and RIGHT actually refer to the &quot;primary&quot; and</span>
<span class="sd">        &quot;secondary&quot; buttons, i.e. if the user inverts their left and right</span>
<span class="sd">        buttons (&quot;left-handed setting&quot;) then the LEFT button will be the one</span>
<span class="sd">        physically on the right.</span>

<span class="sd">    key : None or str</span>
<span class="sd">        The key pressed when the mouse event triggered, e.g. &#39;shift&#39;.</span>
<span class="sd">        See `KeyEvent`.</span>

<span class="sd">        .. warning::</span>
<span class="sd">           This key is currently obtained from the last &#39;key_press_event&#39; or</span>
<span class="sd">           &#39;key_release_event&#39; that occurred within the canvas.  Thus, if the</span>
<span class="sd">           last change of keyboard state occurred while the canvas did not have</span>
<span class="sd">           focus, this attribute will be wrong.</span>

<span class="sd">    step : float</span>
<span class="sd">        The number of scroll steps (positive for &#39;up&#39;, negative for &#39;down&#39;).</span>
<span class="sd">        This applies only to &#39;scroll_event&#39; and defaults to 0 otherwise.</span>

<span class="sd">    dblclick : bool</span>
<span class="sd">        Whether the event is a double-click. This applies only to</span>
<span class="sd">        &#39;button_press_event&#39; and is False otherwise. In particular, it&#39;s</span>
<span class="sd">        not used in &#39;button_release_event&#39;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ::</span>

<span class="sd">        def on_press(event):</span>
<span class="sd">            print(&#39;you pressed&#39;, event.button, event.xdata, event.ydata)</span>

<span class="sd">        cid = fig.canvas.mpl_connect(&#39;button_press_event&#39;, on_press)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">step</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dblclick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        (*x*, *y*) in figure coords ((0, 0) = bottom left)</span>
<span class="sd">        button pressed None, 1, 2, 3, &#39;up&#39;, &#39;down&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">button</span> <span class="ow">in</span> <span class="n">MouseButton</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">button</span> <span class="o">=</span> <span class="n">MouseButton</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button</span> <span class="o">=</span> <span class="n">button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dblclick</span> <span class="o">=</span> <span class="n">dblclick</span>

        <span class="c1"># super-init is deferred to the end because it calls back on</span>
        <span class="c1"># &#39;axes_enter_event&#39;, which requires a fully initialized event.</span>
        <span class="n">LocationEvent</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;xy=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="si">}</span><span class="s2">) xydata=(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">xdata</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ydata</span><span class="si">}</span><span class="s2">) &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;button=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">button</span><span class="si">}</span><span class="s2"> dblclick=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">dblclick</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;inaxes=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">inaxes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PickEvent</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pick event, fired when the user picks a location on the canvas</span>
<span class="sd">    sufficiently close to an artist.</span>

<span class="sd">    Attrs: all the `Event` attributes plus</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    mouseevent : `MouseEvent`</span>
<span class="sd">        The mouse event that generated the pick.</span>
<span class="sd">    artist : `matplotlib.artist.Artist`</span>
<span class="sd">        The picked artist.</span>
<span class="sd">    other</span>
<span class="sd">        Additional attributes may be present depending on the type of the</span>
<span class="sd">        picked object; e.g., a `~.Line2D` pick may define different extra</span>
<span class="sd">        attributes than a `~.PatchCollection` pick.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Bind a function ``on_pick()`` to pick events, that prints the coordinates</span>
<span class="sd">    of the picked data point::</span>

<span class="sd">        ax.plot(np.rand(100), &#39;o&#39;, picker=5)  # 5 points tolerance</span>

<span class="sd">        def on_pick(event):</span>
<span class="sd">            line = event.artist</span>
<span class="sd">            xdata, ydata = line.get_data()</span>
<span class="sd">            ind = event.ind</span>
<span class="sd">            print(&#39;on pick line:&#39;, np.array([xdata[ind], ydata[ind]]).T)</span>

<span class="sd">        cid = fig.canvas.mpl_connect(&#39;pick_event&#39;, on_pick)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span>
                 <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">Event</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouseevent</span> <span class="o">=</span> <span class="n">mouseevent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">artist</span> <span class="o">=</span> <span class="n">artist</span>
        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">KeyEvent</span><span class="p">(</span><span class="n">LocationEvent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A key event (key press, key release).</span>

<span class="sd">    Attach additional attributes as defined in</span>
<span class="sd">    :meth:`FigureCanvasBase.mpl_connect`.</span>

<span class="sd">    In addition to the `Event` and `LocationEvent`</span>
<span class="sd">    attributes, the following attributes are defined:</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    key : None or str</span>
<span class="sd">        the key(s) pressed. Could be **None**, a single case sensitive ascii</span>
<span class="sd">        character (&quot;g&quot;, &quot;G&quot;, &quot;#&quot;, etc.), a special key</span>
<span class="sd">        (&quot;control&quot;, &quot;shift&quot;, &quot;f1&quot;, &quot;up&quot;, etc.) or a</span>
<span class="sd">        combination of the above (e.g., &quot;ctrl+alt+g&quot;, &quot;ctrl+alt+G&quot;).</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Modifier keys will be prefixed to the pressed key and will be in the order</span>
<span class="sd">    &quot;ctrl&quot;, &quot;alt&quot;, &quot;super&quot;. The exception to this rule is when the pressed key</span>
<span class="sd">    is itself a modifier key, therefore &quot;ctrl+alt&quot; and &quot;alt+control&quot; can both</span>
<span class="sd">    be valid key values.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    ::</span>

<span class="sd">        def on_key(event):</span>
<span class="sd">            print(&#39;you pressed&#39;, event.key, event.xdata, event.ydata)</span>

<span class="sd">        cid = fig.canvas.mpl_connect(&#39;key_press_event&#39;, on_key)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="c1"># super-init deferred to the end: callback errors if called before</span>
        <span class="n">LocationEvent</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_renderer</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">print_method</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the renderer that would be used to save a `~.Figure`, and cache it on</span>
<span class="sd">    the figure.</span>

<span class="sd">    If you need a renderer without any active draw methods use</span>
<span class="sd">    renderer._draw_disabled to temporary patch them out at your call site.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This is implemented by triggering a draw, then immediately jumping out of</span>
    <span class="c1"># Figure.draw() by raising an exception.</span>

    <span class="k">class</span> <span class="nc">Done</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">):</span> <span class="k">raise</span> <span class="n">Done</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="n">figure</span><span class="p">,</span> <span class="n">draw</span><span class="o">=</span><span class="n">_draw</span><span class="p">):</span>
        <span class="n">orig_canvas</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">canvas</span>
        <span class="k">if</span> <span class="n">print_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
            <span class="c1"># Even for a canvas&#39; default output type, a canvas switch may be</span>
            <span class="c1"># needed, e.g. for FigureCanvasBase.</span>
            <span class="n">print_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                <span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_get_output_canvas</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">fmt</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;print_</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">print_method</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Done</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">renderer</span><span class="p">,</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">_cachedRenderer</span><span class="p">,</span> <span class="o">=</span> <span class="n">exc</span><span class="o">.</span><span class="n">args</span>
            <span class="k">return</span> <span class="n">renderer</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">print_method</span><span class="si">}</span><span class="s2"> did not call Figure.draw, so &quot;</span>
                               <span class="sa">f</span><span class="s2">&quot;no renderer is available&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">figure</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">orig_canvas</span>


<span class="k">def</span> <span class="nf">_is_non_interactive_terminal_ipython</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return whether we are in a a terminal IPython, but non interactive.</span>

<span class="sd">    When in _terminal_ IPython, ip.parent will have and `interact` attribute,</span>
<span class="sd">    if this attribute is False we do not setup eventloop integration as the</span>
<span class="sd">    user will _not_ interact with IPython. In all other case (ZMQKernel, or is</span>
<span class="sd">    interactive), we do.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
            <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ip</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;interact&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_savefig_extra_args</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_kwargs</span><span class="o">=</span><span class="p">()):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator for the final print_* methods that accept keyword arguments.</span>

<span class="sd">    If any unused keyword arguments are left, this decorator will warn about</span>
<span class="sd">    them, and as part of the warning, will attempt to specify the function that</span>
<span class="sd">    the user actually called, instead of the backend-specific method. If unable</span>
<span class="sd">    to determine which function the user called, it will specify `.savefig`.</span>

<span class="sd">    For compatibility across backends, this does not warn about keyword</span>
<span class="sd">    arguments added by `FigureCanvasBase.print_figure` for use in a subset of</span>
<span class="sd">    backends, because the user would not have added them directly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">_check_savefig_extra_args</span><span class="p">,</span>
                                 <span class="n">extra_kwargs</span><span class="o">=</span><span class="n">extra_kwargs</span><span class="p">)</span>

    <span class="n">old_sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;savefig&#39;</span>  <span class="c1"># Reasonable default guess.</span>
        <span class="n">public_api</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^savefig|print_[A-Za-z0-9]+$&#39;</span><span class="p">)</span>
        <span class="n">seen_print_figure</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">frame</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">traceback</span><span class="o">.</span><span class="n">walk_stack</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">frame</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># when called in embedded context may hit frame is None.</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\A(matplotlib|mpl_toolkits)(\Z|\.(?!tests\.))&#39;</span><span class="p">,</span>
                        <span class="c1"># Work around sphinx-gallery not setting __name__.</span>
                        <span class="n">frame</span><span class="o">.</span><span class="n">f_globals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">public_api</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">):</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;print_figure&#39;</span><span class="p">:</span>
                        <span class="n">seen_print_figure</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="n">accepted_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="o">*</span><span class="n">old_sig</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="o">*</span><span class="n">extra_kwargs</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">seen_print_figure</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kw</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">,</span> <span class="s1">&#39;facecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">,</span> <span class="s1">&#39;orientation&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;bbox_inches_restore&#39;</span><span class="p">]:</span>
                <span class="c1"># Ignore keyword arguments that are passed in by print_figure</span>
                <span class="c1"># for the use of other renderers.</span>
                <span class="k">if</span> <span class="n">kw</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">accepted_kwargs</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">kw</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">accepted_kwargs</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">cbook</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s1">&#39;3.3&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1">() got unexpected keyword argument &quot;&#39;</span>
                        <span class="o">+</span> <span class="n">arg</span> <span class="o">+</span> <span class="s1">&#39;&quot; which is no longer supported as of &#39;</span>
                        <span class="s1">&#39;</span><span class="si">%(since)s</span><span class="s1"> and will become an error &#39;</span>
                        <span class="s1">&#39;</span><span class="si">%(removal)s</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">class</span> <span class="nc">FigureCanvasBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The canvas the figure renders into.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    figure : `matplotlib.figure.Figure`</span>
<span class="sd">        A high-level figure instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set to one of {&quot;qt5&quot;, &quot;qt4&quot;, &quot;gtk3&quot;, &quot;wx&quot;, &quot;tk&quot;, &quot;macosx&quot;} if an</span>
    <span class="c1"># interactive framework is required, or None otherwise.</span>
    <span class="n">required_interactive_framework</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">events</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;resize_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;draw_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;key_release_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scroll_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;pick_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;figure_leave_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;axes_enter_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;axes_leave_event&#39;</span><span class="p">,</span>
        <span class="s1">&#39;close_event&#39;</span>
    <span class="p">]</span>

    <span class="n">fixed_dpi</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">filetypes</span> <span class="o">=</span> <span class="n">_default_filetypes</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">_classproperty</span>
    <span class="k">def</span> <span class="nf">supports_blit</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If this Canvas sub-class supports blitting.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;copy_from_bbox&quot;</span><span class="p">)</span>
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;restore_region&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fix_ipython_backend2gui</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_saving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">figure</span><span class="o">.</span><span class="n">set_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># a dictionary from event name to a dictionary that maps cid-&gt;func</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">CallbackRegistry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widgetlock</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">LockDraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the button pressed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the key pressed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_pick_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scroll_pick_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;scroll_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># the axes currently grabbing mouse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># NavigationToolbar2 will set me</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@classmethod</span>
    <span class="nd">@functools</span><span class="o">.</span><span class="n">lru_cache</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">_fix_ipython_backend2gui</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="c1"># Fix hard-coded module -&gt; toolkit mapping in IPython (used for</span>
        <span class="c1"># `ipython --auto`).  This cannot be done at import time due to</span>
        <span class="c1"># ordering issues, so we do it when creating a canvas, and should only</span>
        <span class="c1"># be done once per class (hence the `lru_cache(1)`).</span>
        <span class="k">if</span> <span class="s2">&quot;IPython&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="kn">import</span> <span class="nn">IPython</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">IPython</span><span class="o">.</span><span class="n">get_ipython</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ip</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="kn">from</span> <span class="nn">IPython.core</span> <span class="kn">import</span> <span class="n">pylabtools</span> <span class="k">as</span> <span class="n">pt</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="s2">&quot;backend2gui&quot;</span><span class="p">)</span>
                <span class="ow">or</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="s2">&quot;enable_matplotlib&quot;</span><span class="p">)):</span>
            <span class="c1"># In case we ever move the patch to IPython and remove these APIs,</span>
            <span class="c1"># don&#39;t break on our side.</span>
            <span class="k">return</span>
        <span class="n">rif</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;required_interactive_framework&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">backend2gui_rif</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;qt5&quot;</span><span class="p">:</span> <span class="s2">&quot;qt&quot;</span><span class="p">,</span> <span class="s2">&quot;qt4&quot;</span><span class="p">:</span> <span class="s2">&quot;qt&quot;</span><span class="p">,</span> <span class="s2">&quot;gtk3&quot;</span><span class="p">:</span> <span class="s2">&quot;gtk3&quot;</span><span class="p">,</span>
                           <span class="s2">&quot;wx&quot;</span><span class="p">:</span> <span class="s2">&quot;wx&quot;</span><span class="p">,</span> <span class="s2">&quot;macosx&quot;</span><span class="p">:</span> <span class="s2">&quot;osx&quot;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rif</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">backend2gui_rif</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_is_non_interactive_terminal_ipython</span><span class="p">(</span><span class="n">ip</span><span class="p">):</span>
                <span class="n">ip</span><span class="o">.</span><span class="n">enable_gui</span><span class="p">(</span><span class="n">backend2gui_rif</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">_idle_draw_cntx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">is_saving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return whether the renderer is in the process of saving</span>
<span class="sd">        to a file, rather than rendering for an on-screen buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_saving</span>

    <span class="k">def</span> <span class="nf">pick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">pick</span><span class="p">(</span><span class="n">mouseevent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">blit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Blit the canvas in bbox (default entire canvas).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the canvas size in pixels.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pass a `DrawEvent` to all functions connected to ``draw_event``.&quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;draw_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">DrawEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resize_event</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `ResizeEvent` to all functions connected to ``resize_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;resize_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">ResizeEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">close_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `CloseEvent` to all functions connected to ``close_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;close_event&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">CloseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">pass</span>
            <span class="c1"># Suppress the TypeError when the python session is being killed.</span>
            <span class="c1"># It may be that a better solution would be a mechanism to</span>
            <span class="c1"># disconnect all callbacks upon shutdown.</span>
            <span class="c1"># AttributeError occurs on OSX with qt4agg upon exiting</span>
            <span class="c1"># with an open window; &#39;callbacks&#39; attribute no longer exists.</span>

    <span class="k">def</span> <span class="nf">key_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `KeyEvent` to all functions connected to ``key_press_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;key_press_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">KeyEvent</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">key_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pass a `KeyEvent` to all functions connected to ``key_release_event``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;key_release_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">KeyEvent</span><span class="p">(</span>
            <span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_key</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">pick_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for pick events.</span>

<span class="sd">        This method will be called by artists who are picked and will</span>
<span class="sd">        fire off `PickEvent` callbacks registered listeners.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;pick_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PickEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span>
                          <span class="n">guiEvent</span><span class="o">=</span><span class="n">mouseevent</span><span class="o">.</span><span class="n">guiEvent</span><span class="p">,</span>
                          <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">scroll_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for scroll events.</span>

<span class="sd">        Backend derived classes should call this function on any</span>
<span class="sd">        scroll wheel event.  (*x*, *y*) are the canvas coords ((0, 0) is lower</span>
<span class="sd">        left).  button and key are as defined in `MouseEvent`.</span>

<span class="sd">        This method will call all functions connected to the &#39;scroll_event&#39;</span>
<span class="sd">        with a `MouseEvent` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;scroll_event&#39;</span>
        <span class="n">mouseevent</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span>
                                <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">dblclick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for mouse button press events.</span>

<span class="sd">        Backend derived classes should call this function on any mouse</span>
<span class="sd">        button press.  (*x*, *y*) are the canvas coords ((0, 0) is lower left).</span>
<span class="sd">        button and key are as defined in `MouseEvent`.</span>

<span class="sd">        This method will call all functions connected to the</span>
<span class="sd">        &#39;button_press_event&#39; with a `MouseEvent` instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="n">button</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;button_press_event&#39;</span>
        <span class="n">mouseevent</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span>
                                <span class="n">dblclick</span><span class="o">=</span><span class="n">dblclick</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">mouseevent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for mouse button release events.</span>

<span class="sd">        Backend derived classes should call this function on any mouse</span>
<span class="sd">        button release.</span>

<span class="sd">        This method will call all functions connected to the</span>
<span class="sd">        &#39;button_release_event&#39; with a `MouseEvent` instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float</span>
<span class="sd">            The canvas coordinates where 0=left.</span>
<span class="sd">        y : float</span>
<span class="sd">            The canvas coordinates where 0=bottom.</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;button_release_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">motion_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for mouse movement events.</span>

<span class="sd">        Backend derived classes should call this function on any</span>
<span class="sd">        motion-notify-event.</span>

<span class="sd">        This method will call all functions connected to the</span>
<span class="sd">        &#39;motion_notify_event&#39; with a `MouseEvent` instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : float</span>
<span class="sd">            The canvas coordinates where 0=left.</span>
<span class="sd">        y : float</span>
<span class="sd">            The canvas coordinates where 0=bottom.</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;motion_notify_event&#39;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">MouseEvent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_key</span><span class="p">,</span>
                           <span class="n">guiEvent</span><span class="o">=</span><span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">leave_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for the mouse cursor leaving the canvas.</span>

<span class="sd">        Backend derived classes should call this function when leaving</span>
<span class="sd">        canvas.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;figure_leave_event&#39;</span><span class="p">,</span> <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span><span class="p">)</span>
        <span class="n">LocationEvent</span><span class="o">.</span><span class="n">lastevent</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">enter_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback processing for the mouse cursor entering the canvas.</span>

<span class="sd">        Backend derived classes should call this function when entering</span>
<span class="sd">        canvas.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        guiEvent</span>
<span class="sd">            The native UI event that generated the Matplotlib event.</span>
<span class="sd">        xy : (float, float)</span>
<span class="sd">            The coordinate location of the pointer when the canvas is entered.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">xy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lastx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lasty</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">cbook</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                <span class="s1">&#39;3.0&#39;</span><span class="p">,</span> <span class="n">removal</span><span class="o">=</span><span class="s1">&#39;3.5&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;enter_notify_event&#39;</span><span class="p">,</span>
                <span class="n">message</span><span class="o">=</span><span class="s1">&#39;Since </span><span class="si">%(since)s</span><span class="s1">, </span><span class="si">%(name)s</span><span class="s1"> expects a location but &#39;</span>
                <span class="s1">&#39;your backend did not pass one. This will become an error &#39;</span>
                <span class="s1">&#39;</span><span class="si">%(removal)s</span><span class="s1">.&#39;</span><span class="p">)</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">LocationEvent</span><span class="p">(</span><span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s1">&#39;figure_enter_event&#39;</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">inaxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the topmost visible `~.axes.Axes` containing the point *xy*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xy : (float, float)</span>
<span class="sd">            (x, y) pixel positions from left/bottom of the canvas.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        `~matplotlib.axes.Axes` or None</span>
<span class="sd">            The topmost visible axes containing the point, or None if no axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axes_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
                     <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">contains_point</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()]</span>
        <span class="k">if</span> <span class="n">axes_list</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_topmost_artist</span><span class="p">(</span><span class="n">axes_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">axes</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">axes</span>

    <span class="k">def</span> <span class="nf">grab_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the child `~.axes.Axes` which is grabbing the mouse events.</span>

<span class="sd">        Usually called by the widgets themselves. It is an error to call this</span>
<span class="sd">        if the mouse is already grabbed by another axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Another Axes already grabs mouse input&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">=</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">release_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Release the mouse grab held by the `~.axes.Axes` *ax*.</span>

<span class="sd">        Usually called by the widgets. It is ok to call this even if *ax*</span>
<span class="sd">        doesn&#39;t have the mouse grab currently.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="ow">is</span> <span class="n">ax</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mouse_grabber</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Render the `.Figure`.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_idle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Request a widget redraw once control returns to the GUI event loop.</span>

<span class="sd">        Even if multiple calls to `draw_idle` occur before control returns</span>
<span class="sd">        to the GUI event loop, the figure will only be rendered once.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Backends may choose to override the method and implement their own</span>
<span class="sd">        strategy to prevent multiple renderings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_idle_drawing</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idle_draw_cntx</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.2&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">draw_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a cursor in the event.axes if inaxes is not None.  Use</span>
<span class="sd">        native GUI drawing for efficiency if possible</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_width_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the figure width and height in points or pixels</span>
<span class="sd">        (depending on the backend), truncated to integers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_filetypes</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return dict of savefig file formats supported by this backend.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">filetypes</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_supported_filetypes_grouped</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a dict of savefig file formats supported by this backend,</span>
<span class="sd">        where the keys are a file type name, such as &#39;Joint Photographic</span>
<span class="sd">        Experts Group&#39;, and the values are a list of filename extensions used</span>
<span class="sd">        for that filetype, such as [&#39;jpg&#39;, &#39;jpeg&#39;].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">groupings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">ext</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">filetypes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">groupings</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ext</span><span class="p">)</span>
            <span class="n">groupings</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">groupings</span>

    <span class="k">def</span> <span class="nf">_get_output_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">backend</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the canvas in preparation for saving the figure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        backend : str or None</span>
<span class="sd">            If not None, switch the figure canvas to the ``FigureCanvas`` class</span>
<span class="sd">            of the given backend.</span>
<span class="sd">        fmt : str</span>
<span class="sd">            If *backend* is None, then determine a suitable canvas class for</span>
<span class="sd">            saving to format *fmt* -- either the current canvas class, if it</span>
<span class="sd">            supports *fmt*, or whatever `get_registered_canvas_class` returns;</span>
<span class="sd">            switch the figure canvas to that canvas class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">backend</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Return a specific canvas class, if requested.</span>
            <span class="n">canvas_class</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="n">cbook</span><span class="o">.</span><span class="n">_backend_module_name</span><span class="p">(</span><span class="n">backend</span><span class="p">))</span>
                <span class="o">.</span><span class="n">FigureCanvas</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">canvas_class</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;print_</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The </span><span class="si">{</span><span class="n">backend</span><span class="si">!r}</span><span class="s2"> backend does not support </span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2"> output&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;print_</span><span class="si">{</span><span class="n">fmt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="c1"># Return the current canvas if it supports the requested format.</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Return a default canvas for the requested format, if it exists.</span>
            <span class="n">canvas_class</span> <span class="o">=</span> <span class="n">get_registered_canvas_class</span><span class="p">(</span><span class="n">fmt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">canvas_class</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_backends</span><span class="p">(</span><span class="n">canvas_class</span><span class="p">)</span>
        <span class="c1"># Else report error for unsupported format.</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Format </span><span class="si">{!r}</span><span class="s2"> is not supported (supported formats: </span><span class="si">{}</span><span class="s2">)&quot;</span>
            <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmt</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_supported_filetypes</span><span class="p">()))))</span>

    <span class="k">def</span> <span class="nf">print_figure</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;portrait&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
            <span class="n">bbox_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad_inches</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">backend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the figure to hardcopy. Set the figure patch face and edge</span>
<span class="sd">        colors.  This is useful because some of the GUIs have a gray figure</span>
<span class="sd">        face color background and you&#39;ll probably want to override this on</span>
<span class="sd">        hardcopy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str or path-like or file-like</span>
<span class="sd">            The file where the figure is saved.</span>

<span class="sd">        dpi : float, default: :rc:`savefig.dpi`</span>
<span class="sd">            The dots per inch to save the figure in.</span>

<span class="sd">        facecolor : color or &#39;auto&#39;, default: :rc:`savefig.facecolor`</span>
<span class="sd">            The facecolor of the figure.  If &#39;auto&#39;, use the current figure</span>
<span class="sd">            facecolor.</span>

<span class="sd">        edgecolor : color or &#39;auto&#39;, default: :rc:`savefig.edgecolor`</span>
<span class="sd">            The edgecolor of the figure.  If &#39;auto&#39;, use the current figure</span>
<span class="sd">            edgecolor.</span>

<span class="sd">        orientation : {&#39;landscape&#39;, &#39;portrait&#39;}, default: &#39;portrait&#39;</span>
<span class="sd">            Only currently applies to PostScript printing.</span>

<span class="sd">        format : str, optional</span>
<span class="sd">            Force a specific file format. If not given, the format is inferred</span>
<span class="sd">            from the *filename* extension, and if that fails from</span>
<span class="sd">            :rc:`savefig.format`.</span>

<span class="sd">        bbox_inches : &#39;tight&#39; or `.Bbox`, default: :rc:`savefig.bbox`</span>
<span class="sd">            Bounding box in inches: only the given portion of the figure is</span>
<span class="sd">            saved.  If &#39;tight&#39;, try to figure out the tight bbox of the figure.</span>

<span class="sd">        pad_inches : float, default: :rc:`savefig.pad_inches`</span>
<span class="sd">            Amount of padding around the figure when *bbox_inches* is &#39;tight&#39;.</span>

<span class="sd">        bbox_extra_artists : list of `~matplotlib.artist.Artist`, optional</span>
<span class="sd">            A list of extra artists that will be considered when the</span>
<span class="sd">            tight bbox is calculated.</span>

<span class="sd">        backend : str, optional</span>
<span class="sd">            Use a non-default backend to render the file, e.g. to render a</span>
<span class="sd">            png file with the &quot;cairo&quot; backend rather than the default &quot;agg&quot;,</span>
<span class="sd">            or a pdf file with the &quot;pgf&quot; backend rather than the default</span>
<span class="sd">            &quot;pdf&quot;.  Note that the default backend is normally sufficient.  See</span>
<span class="sd">            :ref:`the-builtin-backends` for a list of valid backends for each</span>
<span class="sd">            file format.  Custom backends can be referenced as &quot;module://...&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># get format from filename, or from backend&#39;s default filetype</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">PathLike</span><span class="p">):</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="nb">format</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nb">format</span>
        <span class="nb">format</span> <span class="o">=</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># get canvas object and print method for format</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_output_canvas</span><span class="p">(</span><span class="n">backend</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
        <span class="n">print_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="s1">&#39;print_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">format</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dpi</span> <span class="o">==</span> <span class="s1">&#39;figure&#39;</span><span class="p">:</span>
            <span class="n">dpi</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="s1">&#39;_original_dpi&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="c1"># Remove the figure manager, if any, to avoid resizing the GUI widget.</span>
        <span class="c1"># Some code (e.g. Figure.show) differentiates between having *no*</span>
        <span class="c1"># manager and a *None* manager, which should be fixed at some point,</span>
        <span class="c1"># but this should be fine.</span>
        <span class="k">with</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> \
                <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">),</span> \
                <span class="n">cbook</span><span class="o">.</span><span class="n">_setattr_cm</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">_is_saving</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">origfacecolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
            <span class="n">origedgecolor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_edgecolor</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">facecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">facecolor</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.facecolor&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_str_equal</span><span class="p">(</span><span class="n">facecolor</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">):</span>
                <span class="n">facecolor</span> <span class="o">=</span> <span class="n">origfacecolor</span>
            <span class="k">if</span> <span class="n">edgecolor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.edgecolor&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_str_equal</span><span class="p">(</span><span class="n">edgecolor</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">):</span>
                <span class="n">edgecolor</span> <span class="o">=</span> <span class="n">origedgecolor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">facecolor</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">edgecolor</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">bbox_inches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bbox_inches</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.bbox&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">bbox_inches</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bbox_inches</span> <span class="o">==</span> <span class="s2">&quot;tight&quot;</span><span class="p">:</span>
                    <span class="n">renderer</span> <span class="o">=</span> <span class="n">_get_renderer</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span>
                        <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
                            <span class="n">print_method</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">ctx</span> <span class="o">=</span> <span class="p">(</span><span class="n">renderer</span><span class="o">.</span><span class="n">_draw_disabled</span><span class="p">()</span>
                           <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">renderer</span><span class="p">,</span> <span class="s1">&#39;_draw_disabled&#39;</span><span class="p">)</span>
                           <span class="k">else</span> <span class="n">suppress</span><span class="p">())</span>
                    <span class="k">with</span> <span class="n">ctx</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

                    <span class="n">bbox_inches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_tightbbox</span><span class="p">(</span>
                        <span class="n">renderer</span><span class="p">,</span> <span class="n">bbox_extra_artists</span><span class="o">=</span><span class="n">bbox_extra_artists</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pad_inches</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">pad_inches</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.pad_inches&#39;</span><span class="p">]</span>
                    <span class="n">bbox_inches</span> <span class="o">=</span> <span class="n">bbox_inches</span><span class="o">.</span><span class="n">padded</span><span class="p">(</span><span class="n">pad_inches</span><span class="p">)</span>

                <span class="c1"># call adjust_bbox to save only the given area</span>
                <span class="n">restore_bbox</span> <span class="o">=</span> <span class="n">tight_bbox</span><span class="o">.</span><span class="n">adjust_bbox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="p">,</span>
                                                      <span class="n">canvas</span><span class="o">.</span><span class="n">fixed_dpi</span><span class="p">)</span>

                <span class="n">_bbox_inches_restore</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbox_inches</span><span class="p">,</span> <span class="n">restore_bbox</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_bbox_inches_restore</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">print_method</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
                    <span class="n">edgecolor</span><span class="o">=</span><span class="n">edgecolor</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
                    <span class="n">bbox_inches_restore</span><span class="o">=</span><span class="n">_bbox_inches_restore</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bbox_inches</span> <span class="ow">and</span> <span class="n">restore_bbox</span><span class="p">:</span>
                    <span class="n">restore_bbox</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">origfacecolor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">origedgecolor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_filetype</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the default savefig file format as specified in</span>
<span class="sd">        :rc:`savefig.format`.</span>

<span class="sd">        The returned string does not include a period. This method is</span>
<span class="sd">        overridden in backends that only support a single file type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.format&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the title text of the window containing the figure, or None</span>
<span class="sd">        if there is no window (e.g., a PS backend).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">get_window_title</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the title text of the window containing the figure.  Note that</span>
<span class="sd">        this has no effect if there is no window (e.g., a PS backend).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">set_window_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_default_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a string, which includes extension, suitable for use as</span>
<span class="sd">        a default filename.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_basename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_window_title</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;image&#39;</span>
        <span class="n">default_basename</span> <span class="o">=</span> <span class="n">default_basename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">default_filetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
        <span class="n">default_filename</span> <span class="o">=</span> <span class="n">default_basename</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">default_filetype</span>
        <span class="k">return</span> <span class="n">default_filename</span>

    <span class="k">def</span> <span class="nf">switch_backends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">FigureCanvasClass</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Instantiate an instance of FigureCanvasClass</span>

<span class="sd">        This is used for backend switching, e.g., to instantiate a</span>
<span class="sd">        FigureCanvasPS from a FigureCanvasGTK.  Note, deep copying is</span>
<span class="sd">        not done, so any changes to one of the instances (e.g., setting</span>
<span class="sd">        figure size or line props), will be reflected in the other</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">newCanvas</span> <span class="o">=</span> <span class="n">FigureCanvasClass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
        <span class="n">newCanvas</span><span class="o">.</span><span class="n">_is_saving</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_saving</span>
        <span class="k">return</span> <span class="n">newCanvas</span>

    <span class="k">def</span> <span class="nf">mpl_connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bind function *func* to event *s*.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str</span>
<span class="sd">            One of the following events ids:</span>

<span class="sd">            - &#39;button_press_event&#39;</span>
<span class="sd">            - &#39;button_release_event&#39;</span>
<span class="sd">            - &#39;draw_event&#39;</span>
<span class="sd">            - &#39;key_press_event&#39;</span>
<span class="sd">            - &#39;key_release_event&#39;</span>
<span class="sd">            - &#39;motion_notify_event&#39;</span>
<span class="sd">            - &#39;pick_event&#39;</span>
<span class="sd">            - &#39;resize_event&#39;</span>
<span class="sd">            - &#39;scroll_event&#39;</span>
<span class="sd">            - &#39;figure_enter_event&#39;,</span>
<span class="sd">            - &#39;figure_leave_event&#39;,</span>
<span class="sd">            - &#39;axes_enter_event&#39;,</span>
<span class="sd">            - &#39;axes_leave_event&#39;</span>
<span class="sd">            - &#39;close_event&#39;.</span>

<span class="sd">        func : callable</span>
<span class="sd">            The callback function to be executed, which must have the</span>
<span class="sd">            signature::</span>

<span class="sd">                def func(event: Event) -&gt; Any</span>

<span class="sd">            For the location events (button and key press/release), if the</span>
<span class="sd">            mouse is over the axes, the ``inaxes`` attribute of the event will</span>
<span class="sd">            be set to the `~matplotlib.axes.Axes` the event occurs is over, and</span>
<span class="sd">            additionally, the variables ``xdata`` and ``ydata`` attributes will</span>
<span class="sd">            be set to the mouse location in data coordinates.  See `.KeyEvent`</span>
<span class="sd">            and `.MouseEvent` for more info.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cid</span>
<span class="sd">            A connection id that can be used with</span>
<span class="sd">            `.FigureCanvasBase.mpl_disconnect`.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            def on_press(event):</span>
<span class="sd">                print(&#39;you pressed&#39;, event.button, event.xdata, event.ydata)</span>

<span class="sd">            cid = canvas.mpl_connect(&#39;button_press_event&#39;, on_press)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect the callback with id *cid*.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        ::</span>

<span class="sd">            cid = canvas.mpl_connect(&#39;button_press_event&#39;, on_press)</span>
<span class="sd">            # ... later</span>
<span class="sd">            canvas.mpl_disconnect(cid)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>

    <span class="c1"># Internal subclasses can override _timer_cls instead of new_timer, though</span>
    <span class="c1"># this is not a public API for third-party subclasses.</span>
    <span class="n">_timer_cls</span> <span class="o">=</span> <span class="n">TimerBase</span>

    <span class="k">def</span> <span class="nf">new_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new backend-specific subclass of `.Timer`.</span>

<span class="sd">        This is useful for getting periodic events through the backend&#39;s native</span>
<span class="sd">        event loop.  Implemented only for backends with GUIs.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        interval : int</span>
<span class="sd">            Timer interval in milliseconds.</span>

<span class="sd">        callbacks : List[Tuple[callable, Tuple, Dict]]</span>
<span class="sd">            Sequence of (func, args, kwargs) where ``func(*args, **kwargs)``</span>
<span class="sd">            will be executed by the timer every *interval*.</span>

<span class="sd">            Callbacks which return ``False`` or ``0`` will be removed from the</span>
<span class="sd">            timer.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; timer = fig.canvas.new_timer(callbacks=[(f1, (1,), {&#39;a&#39;: 3})])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer_cls</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">flush_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flush the GUI events for the figure.</span>

<span class="sd">        Interactive backends need to reimplement this method.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">start_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start a blocking event loop.</span>

<span class="sd">        Such an event loop is used by interactive functions, such as</span>
<span class="sd">        `~.Figure.ginput` and `~.Figure.waitforbuttonpress`, to wait for</span>
<span class="sd">        events.</span>

<span class="sd">        The event loop blocks until a callback function triggers</span>
<span class="sd">        `stop_event_loop`, or *timeout* is reached.</span>

<span class="sd">        If *timeout* is 0 or negative, never timeout.</span>

<span class="sd">        Only interactive backends need to reimplement this method and it relies</span>
<span class="sd">        on `flush_events` being properly implemented.</span>

<span class="sd">        Interactive backends should implement this in a more native way.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="n">timestep</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_looping</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_looping</span> <span class="ow">and</span> <span class="n">counter</span> <span class="o">*</span> <span class="n">timestep</span> <span class="o">&lt;</span> <span class="n">timeout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flush_events</span><span class="p">()</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">timestep</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">stop_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop the current blocking event loop.</span>

<span class="sd">        Interactive backends need to reimplement this to match</span>
<span class="sd">        `start_event_loop`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_looping</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">def</span> <span class="nf">key_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolbar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement the default Matplotlib key bindings for the canvas and toolbar</span>
<span class="sd">    described at :ref:`key-event-handling`.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    event : `KeyEvent`</span>
<span class="sd">        A key press/release event.</span>
<span class="sd">    canvas : `FigureCanvasBase`, default: ``event.canvas``</span>
<span class="sd">        The backend-specific canvas instance.  This parameter is kept for</span>
<span class="sd">        back-compatibility, but, if set, should always be equal to</span>
<span class="sd">        ``event.canvas``.</span>
<span class="sd">    toolbar : `NavigationToolbar2`, default: ``event.canvas.toolbar``</span>
<span class="sd">        The navigation cursor toolbar.  This parameter is kept for</span>
<span class="sd">        back-compatibility, but, if set, should always be equal to</span>
<span class="sd">        ``event.canvas.toolbar``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># these bindings happen whether you are over an axes or not</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">canvas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span>
    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span>

    <span class="c1"># Load key-mappings from rcParams.</span>
    <span class="n">fullscreen_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.fullscreen&#39;</span><span class="p">]</span>
    <span class="n">home_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.home&#39;</span><span class="p">]</span>
    <span class="n">back_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.back&#39;</span><span class="p">]</span>
    <span class="n">forward_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.forward&#39;</span><span class="p">]</span>
    <span class="n">pan_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.pan&#39;</span><span class="p">]</span>
    <span class="n">zoom_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.zoom&#39;</span><span class="p">]</span>
    <span class="n">save_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.save&#39;</span><span class="p">]</span>
    <span class="n">quit_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.quit&#39;</span><span class="p">]</span>
    <span class="n">quit_all_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.quit_all&#39;</span><span class="p">]</span>
    <span class="n">grid_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.grid&#39;</span><span class="p">]</span>
    <span class="n">grid_minor_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.grid_minor&#39;</span><span class="p">]</span>
    <span class="n">toggle_yscale_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.yscale&#39;</span><span class="p">]</span>
    <span class="n">toggle_xscale_keys</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.xscale&#39;</span><span class="p">]</span>
    <span class="n">all_keys</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">rcParams</span><span class="p">,</span> <span class="s1">&#39;keymap.all_axes&#39;</span><span class="p">)</span>

    <span class="c1"># toggle fullscreen mode (&#39;f&#39;, &#39;ctrl + f&#39;)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">fullscreen_keys</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">manager</span><span class="o">.</span><span class="n">full_screen_toggle</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="c1"># quit the figure (default key &#39;ctrl+w&#39;)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">quit_keys</span><span class="p">:</span>
        <span class="n">Gcf</span><span class="o">.</span><span class="n">destroy_fig</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">quit_all_keys</span><span class="p">:</span>
        <span class="n">Gcf</span><span class="o">.</span><span class="n">destroy_all</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># home or reset mnemonic  (default key &#39;h&#39;, &#39;home&#39; and &#39;r&#39;)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">home_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="c1"># forward / backward keys to enable left handed quick navigation</span>
        <span class="c1"># (default key for backward: &#39;left&#39;, &#39;backspace&#39; and &#39;c&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">back_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
        <span class="c1"># (default key for forward: &#39;right&#39; and &#39;v&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">forward_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="c1"># pan mnemonic (default key &#39;p&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">pan_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">pan</span><span class="p">()</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">_update_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># zoom mnemonic (default key &#39;o&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">zoom_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">zoom</span><span class="p">()</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">_update_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c1"># saving current figure (default key &#39;s&#39;)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">save_keys</span><span class="p">:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">save_figure</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># these bindings require the mouse to be over an axes to trigger</span>
    <span class="k">def</span> <span class="nf">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ticks</span><span class="p">):</span>
        <span class="c1"># Return True/False if all grid lines are on or off, None if they are</span>
        <span class="c1"># not all in the same state.</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">tick</span><span class="o">.</span><span class="n">gridline</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">tick</span><span class="o">.</span><span class="n">gridline</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">ticks</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span>
    <span class="c1"># toggle major grids in current axes (default key &#39;g&#39;)</span>
    <span class="c1"># Both here and below (for &#39;G&#39;), we do nothing if *any* grid (major or</span>
    <span class="c1"># minor, x or y) is not in a uniform state, to avoid messing up user</span>
    <span class="c1"># customization.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">grid_keys</span>
            <span class="c1"># Exclude minor grids not in a uniform state.</span>
            <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">),</span>
                             <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">)]):</span>
        <span class="n">x_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)</span>
        <span class="n">y_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cycle</span><span class="p">[(</span><span class="n">cycle</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Exclude major grids not in a uniform state.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If turning major grids off, also turn minor grids off.</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">x_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span> <span class="k">if</span> <span class="n">x_state</span> <span class="k">else</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">y_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span> <span class="k">if</span> <span class="n">y_state</span> <span class="k">else</span> <span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># toggle major and minor grids in current axes (default key &#39;G&#39;)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">grid_minor_keys</span>
            <span class="c1"># Exclude major grids not in a uniform state.</span>
            <span class="ow">and</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">),</span>
                             <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">majorTicks</span><span class="p">)]):</span>
        <span class="n">x_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">)</span>
        <span class="n">y_state</span> <span class="o">=</span> <span class="n">_get_uniform_gridstate</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">minorTicks</span><span class="p">)</span>
        <span class="n">cycle</span> <span class="o">=</span> <span class="p">[(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">cycle</span><span class="p">[(</span><span class="n">cycle</span><span class="o">.</span><span class="n">index</span><span class="p">((</span><span class="n">x_state</span><span class="p">,</span> <span class="n">y_state</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">cycle</span><span class="p">)])</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Exclude minor grids not in a uniform state.</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">x_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">y_state</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
            <span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># toggle scaling of y-axes between &#39;log and &#39;linear&#39; (default key &#39;l&#39;)</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">toggle_yscale_keys</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yscale</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># toggle scaling of x-axes between &#39;log and &#39;linear&#39; (default key &#39;k&#39;)</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">toggle_xscale_keys</span><span class="p">:</span>
        <span class="n">scalex</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xscale</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scalex</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">scalex</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">_log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
    <span class="c1"># enable nagivation for all axes that contain the event (default key &#39;a&#39;)</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="ow">in</span> <span class="n">all_keys</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">in_axes</span><span class="p">(</span><span class="n">event</span><span class="p">)):</span>  <span class="c1"># FIXME: Why only these?</span>
                <span class="n">cbook</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                    <span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Toggling axes navigation from the &quot;</span>
                    <span class="s2">&quot;keyboard is deprecated since </span><span class="si">%(since)s</span><span class="s2"> and will be &quot;</span>
                    <span class="s2">&quot;removed </span><span class="si">%(removal)s</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># enable navigation only for axes with this index (if such an axes exist,</span>
    <span class="c1"># otherwise do nothing)</span>
    <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">in_axes</span><span class="p">(</span><span class="n">event</span><span class="p">)):</span>  <span class="c1"># FIXME: Why only these?</span>
                    <span class="n">cbook</span><span class="o">.</span><span class="n">warn_deprecated</span><span class="p">(</span>
                        <span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Toggling axes navigation from the &quot;</span>
                        <span class="s2">&quot;keyboard is deprecated since </span><span class="si">%(since)s</span><span class="s2"> and will be &quot;</span>
                        <span class="s2">&quot;removed </span><span class="si">%(removal)s</span><span class="s2">.&quot;</span><span class="p">)</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">set_navigate</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">button_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">canvas</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">toolbar</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The default Matplotlib button actions for extra mouse buttons.</span>

<span class="sd">    Parameters are as for `key_press_handler`, except that *event* is a</span>
<span class="sd">    `MouseEvent`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">canvas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">canvas</span>
    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">toolbar</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span>
    <span class="k">if</span> <span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">button_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">MouseButton</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">button_name</span> <span class="ow">in</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.back&#39;</span><span class="p">]:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">button_name</span> <span class="ow">in</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;keymap.forward&#39;</span><span class="p">]:</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">NonGuiException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raised when trying show a figure in a non-GUI backend.&quot;&quot;&quot;</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">FigureManagerBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A backend-independent abstraction of a figure container and controller.</span>

<span class="sd">    The figure manager is used by pyplot to interact with the window in a</span>
<span class="sd">    backend-independent way. It&#39;s an adapter for the real (GUI) framework that</span>
<span class="sd">    represents the visual figure on screen.</span>

<span class="sd">    GUI backends define from this class to translate common operations such</span>
<span class="sd">    as *show* or *resize* to the GUI-specific code. Non-GUI backends do not</span>
<span class="sd">    support these operations an can just use the base class.</span>

<span class="sd">    This following basic operations are accessible:</span>

<span class="sd">    **Window operations**</span>

<span class="sd">    - `~.FigureManagerBase.show`</span>
<span class="sd">    - `~.FigureManagerBase.destroy`</span>
<span class="sd">    - `~.FigureManagerBase.full_screen_toggle`</span>
<span class="sd">    - `~.FigureManagerBase.resize`</span>
<span class="sd">    - `~.FigureManagerBase.get_window_title`</span>
<span class="sd">    - `~.FigureManagerBase.set_window_title`</span>

<span class="sd">    **Key and mouse button press handling**</span>

<span class="sd">    The figure manager sets up default key and mouse button press handling by</span>
<span class="sd">    hooking up the `.key_press_handler` to the matplotlib event system. This</span>
<span class="sd">    ensures the same shortcuts and mouse actions across backends.</span>

<span class="sd">    **Other operations**</span>

<span class="sd">    Subclasses will have additional attributes and functions to access</span>
<span class="sd">    additional functionality. This is of course backend-specific. For example,</span>
<span class="sd">    most GUI backends have ``window`` and ``toolbar`` attributes that give</span>
<span class="sd">    access to the native GUI widgets of the respective framework.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    canvas : `FigureCanvasBase`</span>
<span class="sd">        The backend-specific canvas instance.</span>

<span class="sd">    num : int or str</span>
<span class="sd">        The figure number.</span>

<span class="sd">    key_press_handler_id : int</span>
<span class="sd">        The default key handler cid, when using the toolmanager.</span>
<span class="sd">        To disable the default key press handling use::</span>

<span class="sd">            figure.canvas.mpl_disconnect(</span>
<span class="sd">                figure.canvas.manager.key_press_handler_id)</span>

<span class="sd">    button_press_handler_id : int</span>
<span class="sd">        The default mouse button handler cid, when using the toolmanager.</span>
<span class="sd">        To disable the default button press handling use::</span>

<span class="sd">            figure.canvas.mpl_disconnect(</span>
<span class="sd">                figure.canvas.manager.button_press_handler_id)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="bp">self</span>  <span class="c1"># store a pointer to parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">key_press_handler_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_press_handler_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;toolmanager&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">key_press_handler_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
                <span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">key_press</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_press_handler_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
                <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">button_press</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="o">=</span> <span class="p">(</span><span class="n">ToolManager</span><span class="p">(</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;toolmanager&#39;</span>
                            <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_axobserver</span>
        <span class="k">def</span> <span class="nf">notify_axes_change</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
            <span class="c1"># Called whenever the current axes is changed.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">)</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">statusbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        For GUI backends, show the figure window and redraw.</span>
<span class="sd">        For non-GUI backends, raise an exception, unless running headless (i.e.</span>
<span class="sd">        on Linux with an unset DISPLAY); this exception is converted to a</span>
<span class="sd">        warning in `.Figure.show`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This should be overridden in GUI backends.</span>
        <span class="k">if</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_get_running_interactive_framework</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;headless&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NonGuiException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Matplotlib is currently using </span><span class="si">{</span><span class="n">get_backend</span><span class="p">()</span><span class="si">}</span><span class="s2">, which is &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;a non-GUI backend, so cannot show the figure.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">full_screen_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For GUI backends, resize the window (in pixels).&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">key_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implement the default Matplotlib key bindings defined at</span>
<span class="sd">        :ref:`key-event-handling`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;toolmanager&#39;</span><span class="p">:</span>
            <span class="n">key_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">button_press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The default Matplotlib button actions for extra mouse buttons.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;toolmanager&#39;</span><span class="p">:</span>
            <span class="n">button_press_handler</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the title text of the window containing the figure, or None</span>
<span class="sd">        if there is no window (e.g., a PS backend).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;image&#39;</span>

    <span class="k">def</span> <span class="nf">set_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the title text of the window containing the figure.</span>

<span class="sd">        This has no effect for non-GUI (e.g., PS) backends.</span>
<span class="sd">        &quot;&quot;&quot;</span>


<span class="n">cursors</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">cursors</span>


<span class="k">class</span> <span class="nc">_Mode</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="n">NONE</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">PAN</span> <span class="o">=</span> <span class="s2">&quot;pan/zoom&quot;</span>
    <span class="n">ZOOM</span> <span class="o">=</span> <span class="s2">&quot;zoom rect&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_navigate_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="k">if</span> <span class="bp">self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span> <span class="k">else</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">NavigationToolbar2</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for the navigation cursor, version 2.</span>

<span class="sd">    Backends must implement a canvas that handles connections for</span>
<span class="sd">    &#39;button_press_event&#39; and &#39;button_release_event&#39;.  See</span>
<span class="sd">    :meth:`FigureCanvasBase.mpl_connect` for more information.</span>

<span class="sd">    They must also define</span>

<span class="sd">      :meth:`save_figure`</span>
<span class="sd">         save the current figure</span>

<span class="sd">      :meth:`set_cursor`</span>
<span class="sd">         if you want the pointer icon to change</span>

<span class="sd">      :meth:`draw_rubberband` (optional)</span>
<span class="sd">         draw the zoom to rect &quot;rubberband&quot; rectangle</span>

<span class="sd">      :meth:`set_message` (optional)</span>
<span class="sd">         display message</span>

<span class="sd">      :meth:`set_history_buttons` (optional)</span>
<span class="sd">         you can change the history back / forward buttons to</span>
<span class="sd">         indicate disabled / enabled state.</span>

<span class="sd">    and override ``__init__`` to set up the toolbar -- without forgetting to</span>
<span class="sd">    call the base-class init.  Typically, ``__init__`` needs to set up toolbar</span>
<span class="sd">    buttons connected to the `home`, `back`, `forward`, `pan`, `zoom`, and</span>
<span class="sd">    `save_figure` methods and using standard icons in the &quot;images&quot; subdirectory</span>
<span class="sd">    of the data path.</span>

<span class="sd">    That&#39;s it, we&#39;ll do the rest!</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># list of toolitems to add to the toolbar, format is:</span>
    <span class="c1"># (</span>
    <span class="c1">#   text, # the text of the button (often not visible to users)</span>
    <span class="c1">#   tooltip_text, # the tooltip shown on hover (where possible)</span>
    <span class="c1">#   image_file, # name of the image for the button (without the extension)</span>
    <span class="c1">#   name_of_method, # name of the method in NavigationToolbar2 to call</span>
    <span class="c1"># )</span>
    <span class="n">toolitems</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;Home&#39;</span><span class="p">,</span> <span class="s1">&#39;Reset original view&#39;</span><span class="p">,</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span> <span class="s1">&#39;home&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Back&#39;</span><span class="p">,</span> <span class="s1">&#39;Back to previous view&#39;</span><span class="p">,</span> <span class="s1">&#39;back&#39;</span><span class="p">,</span> <span class="s1">&#39;back&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward to next view&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">,</span> <span class="s1">&#39;forward&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Pan&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Left button pans, Right button zooms</span><span class="se">\n</span><span class="s1">&#39;</span>
         <span class="s1">&#39;x/y fixes axis, CTRL fixes aspect&#39;</span><span class="p">,</span>
         <span class="s1">&#39;move&#39;</span><span class="p">,</span> <span class="s1">&#39;pan&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Zoom&#39;</span><span class="p">,</span> <span class="s1">&#39;Zoom to rectangle</span><span class="se">\n</span><span class="s1">x/y fixes axis, CTRL fixes aspect&#39;</span><span class="p">,</span>
         <span class="s1">&#39;zoom_to_rect&#39;</span><span class="p">,</span> <span class="s1">&#39;zoom&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;Configure subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;configure_subplots&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;Save&#39;</span><span class="p">,</span> <span class="s1">&#39;Save the figure&#39;</span><span class="p">,</span> <span class="s1">&#39;filesave&#39;</span><span class="p">,</span> <span class="s1">&#39;save_figure&#39;</span><span class="p">),</span>
      <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="n">canvas</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">Stack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># location and axis info at the time of the press</span>
        <span class="c1"># This cursor will be set after the initial draw.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">POINTER</span>

        <span class="n">init</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_deprecate_method_override</span><span class="p">(</span>
            <span class="vm">__class__</span><span class="o">.</span><span class="n">_init_toolbar</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">allow_empty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span>
            <span class="n">addendum</span><span class="o">=</span><span class="s2">&quot;Please fully initialize the toolbar in your subclass&#39; &quot;</span>
            <span class="s2">&quot;__init__; a fully empty _init_toolbar implementation may be kept &quot;</span>
            <span class="s2">&quot;for compatibility with earlier versions of Matplotlib.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">init</span><span class="p">:</span>
            <span class="n">init</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_id_press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_pan_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_release</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_pan_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_button_pressed</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># determined by button pressed at start</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span>  <span class="c1"># a mode string for the status bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display a message on toolbar or in status bar.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">draw_rubberband</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a rectangle rubberband to indicate zoom limits.</span>

<span class="sd">        Note that it is not guaranteed that ``x0 &lt;= x1`` and ``y0 &lt;= y1``.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">remove_rubberband</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the rubberband.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the original view.</span>

<span class="sd">        For convenience of being directly connected as a GUI callback, which</span>
<span class="sd">        often get passed additional parameters, this method accepts arbitrary</span>
<span class="sd">        parameters, but does not use them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">home</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">back</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move back up the view lim stack.</span>

<span class="sd">        For convenience of being directly connected as a GUI callback, which</span>
<span class="sd">        often get passed additional parameters, this method accepts arbitrary</span>
<span class="sd">        parameters, but does not use them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">back</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move forward in the view lim stack.</span>

<span class="sd">        For convenience of being directly connected as a GUI callback, which</span>
<span class="sd">        often get passed additional parameters, this method accepts arbitrary</span>
<span class="sd">        parameters, but does not use them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_view</span><span class="p">()</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;__init__&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_init_toolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This is where you actually build the GUI widgets (called by</span>
<span class="sd">        __init__).  The icons ``home.xpm``, ``back.xpm``, ``forward.xpm``,</span>
<span class="sd">        ``hand.xpm``, ``zoom_to_rect.xpm`` and ``filesave.xpm`` are standard</span>
<span class="sd">        across backends (there are ppm versions in CVS also).</span>

<span class="sd">        You just need to set the callbacks</span>

<span class="sd">        home         : self.home</span>
<span class="sd">        back         : self.back</span>
<span class="sd">        forward      : self.forward</span>
<span class="sd">        hand         : self.pan</span>
<span class="sd">        zoom_to_rect : self.zoom</span>
<span class="sd">        filesave     : self.save_figure</span>

<span class="sd">        You only need to define the last one - the others are in the base</span>
<span class="sd">        class implementation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_update_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the cursor after a mouse move event or a tool (de)activation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">!=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">POINTER</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">cursors</span><span class="o">.</span><span class="n">POINTER</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">POINTER</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">!=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span>
                  <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">!=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">MOVE</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">cursors</span><span class="o">.</span><span class="n">MOVE</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span> <span class="o">=</span> <span class="n">cursors</span><span class="o">.</span><span class="n">MOVE</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">_wait_cursor_for_draw_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the cursor to a wait cursor when drawing the canvas.</span>

<span class="sd">        In order to avoid constantly changing the cursor when the canvas</span>
<span class="sd">        changes frequently, do nothing if this context was triggered during the</span>
<span class="sd">        last second.  (Optimally we&#39;d prefer only setting the wait cursor if</span>
<span class="sd">        the *current* draw takes too long, but the current draw blocks the GUI</span>
<span class="sd">        thread).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_time</span><span class="p">,</span> <span class="n">last_draw_time</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_draw_time&quot;</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_draw_time</span> <span class="o">-</span> <span class="n">last_draw_time</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="n">cursors</span><span class="o">.</span><span class="n">WAIT</span><span class="p">)</span>
                <span class="k">yield</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lastCursor</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span>

    <span class="k">def</span> <span class="nf">mouse_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_cursor</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">():</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">format_coord</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="n">artists</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">_mouseover_set</span>
                           <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_visible</span><span class="p">()]</span>
                <span class="k">if</span> <span class="n">artists</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_topmost_artist</span><span class="p">(</span><span class="n">artists</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">inaxes</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">get_cursor_data</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">data_str</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">format_cursor_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">data_str</span><span class="p">:</span>
                                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">data_str</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_zoom_pan_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">press_pan</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_release_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">release_pan</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_press_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">press_zoom</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;button_release_event&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">release_zoom</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">press</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called whenever a mouse button is pressed.&quot;&quot;&quot;</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for mouse button release.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle the pan/zoom tool.</span>

<span class="sd">        Pan with left button, zoom with right.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">PAN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_navigate_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">_navigate_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">press_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for mouse button press in pan/zoom mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button_pressed</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_button_pressed</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># set the home button to this view</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">in_axes</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="n">a</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">can_pan</span><span class="p">()):</span>
                <span class="n">a</span><span class="o">.</span><span class="n">start_pan</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
                    <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_pan</span><span class="p">)</span>
        <span class="n">press</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_deprecate_method_override</span><span class="p">(</span>
            <span class="vm">__class__</span><span class="o">.</span><span class="n">press</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Calling an &quot;</span>
            <span class="s2">&quot;overridden press() at pan start is deprecated since </span><span class="si">%(since)s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;and will be removed </span><span class="si">%(removal)s</span><span class="s2">; override press_pan() instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">press</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">press</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drag_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for dragging in pan/zoom mode.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span><span class="p">:</span>
            <span class="c1">#safer to use the recorded button at the press than current button:</span>
            <span class="c1">#multiple button can get pressed during motion...</span>
            <span class="n">a</span><span class="o">.</span><span class="n">drag_pan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_button_pressed</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">release_pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for mouse button release in pan/zoom mode.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_button_pressed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_id_drag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s1">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mouse_move</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">ind</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">end_pan</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button_pressed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_deprecate_method_override</span><span class="p">(</span>
            <span class="vm">__class__</span><span class="o">.</span><span class="n">press</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Calling an &quot;</span>
            <span class="s2">&quot;overridden release() at pan stop is deprecated since </span><span class="si">%(since)s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;and will be removed </span><span class="si">%(removal)s</span><span class="s2">; override release_pan() instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">release</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Toggle zoom to rect mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">NONE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">_Mode</span><span class="o">.</span><span class="n">ZOOM</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">widgetlock</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="n">a</span><span class="o">.</span><span class="n">set_navigate_mode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="o">.</span><span class="n">_navigate_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">press_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for mouse button press in zoom to rect mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">in_axes</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">get_navigate</span><span class="p">()</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">can_zoom</span><span class="p">()]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>  <span class="c1"># set the home button to this view</span>
        <span class="n">id_zoom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span>
            <span class="s2">&quot;motion_notify_event&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">drag_zoom</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;direction&quot;</span><span class="p">:</span> <span class="s2">&quot;in&quot;</span> <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span>
            <span class="s2">&quot;start_xy&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
            <span class="s2">&quot;axes&quot;</span><span class="p">:</span> <span class="n">axes</span><span class="p">,</span>
            <span class="s2">&quot;cid&quot;</span><span class="p">:</span> <span class="n">id_zoom</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">press</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_deprecate_method_override</span><span class="p">(</span>
            <span class="vm">__class__</span><span class="o">.</span><span class="n">press</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Calling an &quot;</span>
            <span class="s2">&quot;overridden press() at zoom start is deprecated since </span><span class="si">%(since)s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;and will be removed </span><span class="si">%(removal)s</span><span class="s2">; override press_zoom() instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">press</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">press</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">drag_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for dragging in zoom mode.&quot;&quot;&quot;</span>
        <span class="n">start_xy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;start_xy&quot;</span><span class="p">]</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span>
            <span class="p">[</span><span class="n">start_xy</span><span class="p">,</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span><span class="p">]],</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span>
            <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">intervaly</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">intervalx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_rubberband</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">release_zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for mouse button release in zoom to rect mode.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># We don&#39;t check the event button here, so that zooms can be cancelled</span>
        <span class="c1"># by (pressing and) releasing another mouse button.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;cid&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_rubberband</span><span class="p">()</span>

        <span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;start_xy&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">]):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">y</span>
            <span class="c1"># ignore singular clicks - 5 pixels is a threshold</span>
            <span class="c1"># allows the user to &quot;cancel&quot; a zoom action</span>
            <span class="c1"># by zooming by less than 5 pixels</span>
            <span class="k">if</span> <span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">start_x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;y&quot;</span><span class="p">)</span> <span class="ow">or</span>
                    <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">start_y</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;x&quot;</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xypress</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">release</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_deprecate_method_override</span><span class="p">(</span>
                    <span class="vm">__class__</span><span class="o">.</span><span class="n">press</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Calling an &quot;</span>
                    <span class="s2">&quot;overridden release() at zoom stop is deprecated since &quot;</span>
                    <span class="s2">&quot;</span><span class="si">%(since)s</span><span class="s2"> and will be removed </span><span class="si">%(removal)s</span><span class="s2">; override &quot;</span>
                    <span class="s2">&quot;release_zoom() instead.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">release</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw</span><span class="p">()</span>
                <span class="k">return</span>

            <span class="c1"># Detect whether this axes is twinned with an earlier axes in the</span>
            <span class="c1"># list of zoomed axes, to avoid double zooming.</span>
            <span class="n">twinx</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_shared_x_axes</span><span class="p">()</span><span class="o">.</span><span class="n">joined</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">prev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">twiny</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_shared_y_axes</span><span class="p">()</span><span class="o">.</span><span class="n">joined</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">prev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;axes&quot;</span><span class="p">][:</span><span class="n">i</span><span class="p">])</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">_set_view_from_bbox</span><span class="p">(</span>
                <span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">],</span>
                <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">twinx</span><span class="p">,</span> <span class="n">twiny</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_zoom_info</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
        <span class="n">release</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_deprecate_method_override</span><span class="p">(</span>
            <span class="vm">__class__</span><span class="o">.</span><span class="n">release</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">since</span><span class="o">=</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;Calling an &quot;</span>
            <span class="s2">&quot;overridden release() at zoom stop is deprecated since </span><span class="si">%(since)s</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;and will be removed </span><span class="si">%(removal)s</span><span class="s2">; override release_zoom() &quot;</span>
            <span class="s2">&quot;instead.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">release</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">release</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">push_current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Push the current view limits and position onto the stack.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span>
            <span class="n">WeakKeyDictionary</span><span class="p">(</span>
                <span class="p">{</span><span class="n">ax</span><span class="p">:</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">_get_view</span><span class="p">(),</span>
                      <span class="c1"># Store both the original and modified positions.</span>
                      <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">frozen</span><span class="p">(),</span>
                       <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">frozen</span><span class="p">()))</span>
                 <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">axes</span><span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>

    <span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="s2">&quot;toolbar.canvas.draw_idle()&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Redraw the canvases, update the locators.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw</span><span class="p">()</span>

    <span class="c1"># Can be removed once Locator.refresh() is removed, and replaced by an</span>
    <span class="c1"># inline call to self.canvas.draw_idle().</span>
    <span class="k">def</span> <span class="nf">_draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">():</span>
            <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;xaxis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s1">&#39;yaxis&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">locators</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">locators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_locator</span><span class="p">())</span>
                <span class="n">locators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_minor_locator</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">locators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_locator</span><span class="p">())</span>
                <span class="n">locators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_minor_locator</span><span class="p">())</span>

            <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locators</span><span class="p">:</span>
                <span class="n">mpl</span><span class="o">.</span><span class="n">ticker</span><span class="o">.</span><span class="n">_if_refresh_overridden_call_and_emit_deprec</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_update_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the viewlim and position from the view and position stack for</span>
<span class="sd">        each axes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nav_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">nav_info</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># Retrieve all items at once to avoid any risk of GC deleting an Axes</span>
        <span class="c1"># while in the middle of the loop below.</span>
        <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nav_info</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="p">(</span><span class="n">pos_orig</span><span class="p">,</span> <span class="n">pos_active</span><span class="p">))</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_view</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
            <span class="c1"># Restore both the original and modified positions</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="n">pos_orig</span><span class="p">,</span> <span class="s1">&#39;original&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">_set_position</span><span class="p">(</span><span class="n">pos_active</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Save the current figure.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the current cursor to one of the :class:`Cursors` enums values.</span>

<span class="sd">        If required by the backend, this method should trigger an update in</span>
<span class="sd">        the backend event loop after the cursor is set, as this method may be</span>
<span class="sd">        called e.g. before a long-running task during which the GUI is not</span>
<span class="sd">        updated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset the axes stack.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nav_stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_history_buttons</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_history_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable or disable the back/forward button.&quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">ToolContainerBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all tool containers, e.g. toolbars.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    toolmanager : `.ToolManager`</span>
<span class="sd">        The tools with which this `ToolContainer` wants to communicate.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_icon_extension</span> <span class="o">=</span> <span class="s1">&#39;.png&#39;</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Toolcontainer button icon image format extension</span>

<span class="sd">    **String**: Image extension</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toolmanager</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="o">=</span> <span class="n">toolmanager</span>
        <span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span>
            <span class="s1">&#39;tool_message_event&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">message</span><span class="p">))</span>
        <span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span>
            <span class="s1">&#39;tool_removed_event&#39;</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_toolitem</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_tool_toggled_cbk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Capture the &#39;tool_trigger_[name]&#39;</span>

<span class="sd">        This only gets used for toggled tools.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toggle_toolitem</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">tool</span><span class="o">.</span><span class="n">toggled</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tool</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">position</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a tool to this container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        tool : tool_like</span>
<span class="sd">            The tool to add, see `.ToolManager.get_tool`.</span>
<span class="sd">        group : str</span>
<span class="sd">            The name of the group to add this tool to.</span>
<span class="sd">        position : int, default: -1</span>
<span class="sd">            The position within the group to place this tool.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="n">tool</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_filename</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
        <span class="n">toggle</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tool</span><span class="p">,</span> <span class="s1">&#39;toggled&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_toolitem</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span>
                          <span class="n">image</span><span class="p">,</span> <span class="n">tool</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">toggle</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span><span class="s1">&#39;tool_trigger_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">_tool_toggled_cbk</span><span class="p">)</span>
            <span class="c1"># If initially toggled</span>
            <span class="k">if</span> <span class="n">tool</span><span class="o">.</span><span class="n">toggled</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toggle_toolitem</span><span class="p">(</span><span class="n">tool</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_image_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find the image based on its name.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">basedir</span> <span class="o">=</span> <span class="n">cbook</span><span class="o">.</span><span class="n">_get_data_path</span><span class="p">(</span><span class="s2">&quot;images&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">image</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icon_extension</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">basedir</span> <span class="o">/</span> <span class="n">image</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">basedir</span> <span class="o">/</span> <span class="p">(</span><span class="n">image</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icon_extension</span><span class="p">)),</span>
        <span class="p">]:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">fname</span>

    <span class="k">def</span> <span class="nf">trigger_tool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Trigger the tool.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name (id) of the tool triggered from within the container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">trigger_tool</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">sender</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_toolitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">toggle</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a toolitem to the container.</span>

<span class="sd">        This method must be implemented per backend.</span>

<span class="sd">        The callback associated with the button click event,</span>
<span class="sd">        must be *exactly* ``self.trigger_tool(name)``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the tool to add, this gets used as the tool&#39;s ID and as the</span>
<span class="sd">            default label of the buttons.</span>
<span class="sd">        group : str</span>
<span class="sd">            Name of the group that this tool belongs to.</span>
<span class="sd">        position : int</span>
<span class="sd">            Position of the tool within its group, if -1 it goes at the end.</span>
<span class="sd">        image_file : str</span>
<span class="sd">            Filename of the image for the button or `None`.</span>
<span class="sd">        description : str</span>
<span class="sd">            Description of the tool, used for the tooltips.</span>
<span class="sd">        toggle : bool</span>
<span class="sd">            * `True` : The button is a toggle (change the pressed/unpressed</span>
<span class="sd">              state between consecutive clicks).</span>
<span class="sd">            * `False` : The button is a normal button (returns to unpressed</span>
<span class="sd">              state after release).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">toggle_toolitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">toggled</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Toggle the toolitem without firing event.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Id of the tool to toggle.</span>
<span class="sd">        toggled : bool</span>
<span class="sd">            Whether to set this tool as toggled or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">remove_toolitem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove a toolitem from the `ToolContainer`.</span>

<span class="sd">        This method must get implemented per backend.</span>

<span class="sd">        Called when `.ToolManager` emits a `tool_removed_event`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the tool to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a message on the toolbar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str</span>
<span class="sd">            Message text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>


<span class="nd">@cbook</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;3.3&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">StatusbarBase</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Base class for the statusbar.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">toolmanager</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span> <span class="o">=</span> <span class="n">toolmanager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolmanager</span><span class="o">.</span><span class="n">toolmanager_connect</span><span class="p">(</span><span class="s1">&#39;tool_message_event&#39;</span><span class="p">,</span>
                                             <span class="bp">self</span><span class="o">.</span><span class="n">_message_cbk</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_message_cbk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Capture the &#39;tool_message_event&#39; and set the message.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_message</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display a message on toolbar or in status bar.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : str</span>
<span class="sd">            Message text.</span>
<span class="sd">        &quot;&quot;&quot;</span>


<span class="k">class</span> <span class="nc">_Backend</span><span class="p">:</span>
    <span class="c1"># A backend can be defined by using the following pattern:</span>
    <span class="c1">#</span>
    <span class="c1"># @_Backend.export</span>
    <span class="c1"># class FooBackend(_Backend):</span>
    <span class="c1">#     # override the attributes and methods documented below.</span>

    <span class="c1"># `backend_version` may be overridden by the subclass.</span>
    <span class="n">backend_version</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>

    <span class="c1"># The `FigureCanvas` class must be defined.</span>
    <span class="n">FigureCanvas</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># For interactive backends, the `FigureManager` class must be overridden.</span>
    <span class="n">FigureManager</span> <span class="o">=</span> <span class="n">FigureManagerBase</span>

    <span class="c1"># The following methods must be left as None for non-interactive backends.</span>
    <span class="c1"># For interactive backends, `trigger_manager_draw` should be a function</span>
    <span class="c1"># taking a manager as argument and triggering a canvas draw, and `mainloop`</span>
    <span class="c1"># should be a function taking no argument and starting the backend main</span>
    <span class="c1"># loop.</span>
    <span class="n">trigger_manager_draw</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mainloop</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># The following methods will be automatically defined and exported, but</span>
    <span class="c1"># can be overridden.</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_figure_manager</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new figure manager instance.&quot;&quot;&quot;</span>
        <span class="c1"># This import needs to happen here due to circular imports.</span>
        <span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="kn">import</span> <span class="n">Figure</span>
        <span class="n">fig_cls</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;FigureClass&#39;</span><span class="p">,</span> <span class="n">Figure</span><span class="p">)</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">fig_cls</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">new_figure_manager_given_figure</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_figure_manager_given_figure</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">figure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new figure manager instance for the given figure.&quot;&quot;&quot;</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FigureCanvas</span><span class="p">(</span><span class="n">figure</span><span class="p">)</span>
        <span class="n">manager</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">FigureManager</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">manager</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">draw_if_interactive</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">trigger_manager_draw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">is_interactive</span><span class="p">():</span>
            <span class="n">manager</span> <span class="o">=</span> <span class="n">Gcf</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">manager</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">trigger_manager_draw</span><span class="p">(</span><span class="n">manager</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show all figures.</span>

<span class="sd">        `show` blocks by calling `mainloop` if *block* is ``True``, or if it</span>
<span class="sd">        is ``None`` and we are neither in IPython&#39;s ``%pylab`` mode, nor in</span>
<span class="sd">        `interactive` mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">managers</span> <span class="o">=</span> <span class="n">Gcf</span><span class="o">.</span><span class="n">get_all_fig_managers</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">managers</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">managers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">manager</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># Emits a warning for non-interactive backend.</span>
            <span class="k">except</span> <span class="n">NonGuiException</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">cbook</span><span class="o">.</span><span class="n">_warn_external</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mainloop</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">block</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Hack: Are we in IPython&#39;s pylab mode?</span>
            <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># IPython versions &gt;= 0.10 tack the _needmain attribute onto</span>
                <span class="c1"># pyplot.show, and always set it to False, when in %pylab mode.</span>
                <span class="n">ipython_pylab</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">show</span><span class="o">.</span><span class="n">_needmain</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">ipython_pylab</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">block</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">ipython_pylab</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_interactive</span><span class="p">()</span>
            <span class="c1"># TODO: The above is a hack to get the WebAgg backend working with</span>
            <span class="c1"># ipython&#39;s `%pylab` mode until proper integration is implemented.</span>
            <span class="k">if</span> <span class="n">get_backend</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;WebAgg&quot;</span><span class="p">:</span>
                <span class="n">block</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">block</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>

    <span class="c1"># This method is the one actually exporting the required methods.</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">export</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;backend_version&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FigureCanvas&quot;</span><span class="p">,</span>
                <span class="s2">&quot;FigureManager&quot;</span><span class="p">,</span>
                <span class="s2">&quot;new_figure_manager&quot;</span><span class="p">,</span>
                <span class="s2">&quot;new_figure_manager_given_figure&quot;</span><span class="p">,</span>
                <span class="s2">&quot;draw_if_interactive&quot;</span><span class="p">,</span>
                <span class="s2">&quot;show&quot;</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">],</span> <span class="n">name</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        <span class="c1"># For back-compatibility, generate a shim `Show` class.</span>

        <span class="k">class</span> <span class="nc">Show</span><span class="p">(</span><span class="n">ShowBase</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">mainloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>

        <span class="nb">setattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__module__</span><span class="p">],</span> <span class="s2">&quot;Show&quot;</span><span class="p">,</span> <span class="n">Show</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>


<span class="k">class</span> <span class="nc">ShowBase</span><span class="p">(</span><span class="n">_Backend</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simple base class to generate a ``show()`` function in backends.</span>

<span class="sd">    Subclass must override ``mainloop()`` method.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="n">block</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, Nick Anthony

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>